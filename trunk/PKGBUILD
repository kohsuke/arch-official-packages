# $Id$
# Maintainer: AndyRTR <andyrtr@archlinux.org>

pkgbase="libreoffice"
pkgname=('libreoffice' 'libreoffice-sdk' 'libreoffice-extension-nlpsolver' 'libreoffice-extension-pdfimport' 'libreoffice-extension-presentation-minimizer' 'libreoffice-extension-presenter-screen' 
         'libreoffice-extension-report-builder' 'libreoffice-extension-wiki-publisher' 'libreoffice-extension-ct2n' 'libreoffice-extension-hunart' 'libreoffice-extension-numbertext'
	 'libreoffice-extension-oooblogger' 'libreoffice-extension-typo' 'libreoffice-extension-watch-window' 'libreoffice-extension-diagram')
_LOver=3.3.99.1
pkgver=3.3.4beta1
pkgrel=1
arch=('i686' 'x86_64')
#_LO_tree="3.4"
_OFFICEUPD="300"
license=('LGPL3')
url="http://www.libreoffice.org/"
makedepends=( # makedepends
             'boost' 'sane' 'perl-archive-zip' 'zip' 'unzip' 'xulrunner' 'unixodbc' 'hsqldb-java'
             'apache-ant' 'gperf' 'poppler' 'kdelibs' 'gconf' 'cppunit'
             'beanshell'  'vigra' 'libldap' 'lucene' 'libmythes' 'junit' 'libwpg' 'imagemagick'
              # for additional ooo-build features
	     'mesa>=7.5' 'gstreamer0.10-base>=0.10.26'
              #'saxon' - currently broken 
             # the depends from libreoffice main pkg
             "curl>=7.20.0" "hunspell>=1.2.8" "python2>=2.7" 'libwpd>=0.9.0' 'libxaw' "neon>=0.28.6"
             'pango' 'nspr' 'libjpeg' 'libxrandr' 'libgl' 'dbus-glib' "icu>=4.6" 'libxslt'
             'redland' 'libgraphite' 'hyphen' 'lpsolve' 'gcc-libs' 'sh'
             'hicolor-icon-theme' 'desktop-file-utils' 'shared-mime-info' 'java-runtime' 'gtk2' # keep gtk2 for install script
	     'ttf-dejavu') # to satisfy regression tests
	     # libwps translate-toolkit libtextcat - todo move them to extra to allow --with-system-foo builds
# http://download.documentfoundation.org/mirrors/all.html
# http://wiki.documentfoundation.org/Mirrors
_mirror="http://download.documentfoundation.org/libreoffice/src"
#_mirror="ftp://ftp.uni-muenster.de/pub/software/tdf/libreoffice/src"
#_mirror="ftp://ftp.astral.ro/mirrors/tdf/libreoffice/src"
_additional_source_url="http://hg.services.openoffice.org/binaries"
source=(${_mirror}/${pkgbase}-{artwork,base,bootstrap,calc,components,extensions,extras,filters,help,impress,libs-core,libs-extern,libs-extern-sys,libs-gui,postprocess,sdk,testing,translations,ure,writer}-${_LOver}.tar.bz2
	${_additional_source_url}/128cfc86ed5953e57fe0f5ae98b62c2e-libtextcat-2.2.tar.gz
	${_additional_source_url}/1f24ab1d39f4a51faf22244c94a6203f-xmlsec1-1.2.14.tar.gz
	${_additional_source_url}/35c94d2df8893241173de1d16b6034c0-swingExSrc.zip
	${_additional_source_url}/798b2ffdc8bcfe7bca2cf92b62caf685-rhino1_5R5.zip
	${_additional_source_url}/fdb27bfe2dbe2e7b57ae194d9bf36bab-SampleICC-1.3.2.tar.gz
	${_additional_source_url}/ada24d37d8d638b3d8a9985e80bc2978-source-9.0.0.7-bj.zip
	${_additional_source_url}/2a177023f9ea8ec8bd00837605c5df1b-jakarta-tomcat-5.0.30-src.tar.gz
	${_additional_source_url}/a7983f859eafb2677d7ff386a023bc40-xsltml_2.1.2.zip
	${_additional_source_url}/3c219630e4302863a9a83d0efde889db-commons-logging-1.1.1-src.tar.gz
	${_additional_source_url}/2ae988b339daec234019a7066f96733e-commons-lang-2.3-src.tar.gz
	${_additional_source_url}/2c9b0f83ed5890af02c0df1c1776f39b-commons-httpclient-3.1-src.tar.gz
	${_additional_source_url}/af3c3acf618de6108d65fcdc92b492e1-commons-codec-1.3-src.tar.gz
	${_additional_source_url}/eeb2c7ddf0d302fba4bfc6e97eac9624-libbase-1.1.6.zip
	${_additional_source_url}/39bb3fcea1514f1369fcfc87542390fd-sacjava-1.3.zip
	${_additional_source_url}/3404ab6b1792ae5f16bbd603bd1e1d03-libformula-1.1.7.zip
	${_additional_source_url}/97b2d4dba862397f446b217e2b623e71-libloader-1.1.6.zip
	${_additional_source_url}/f94d9870737518e3b597f9265f4e9803-libserializer-1.1.6.zip
	${_additional_source_url}/8ce2fcd72becf06c41f7201d15373ed9-librepository-1.1.6.zip
	${_additional_source_url}/d8bd5eed178db6e2b18eeed243f85aa8-flute-1.1.6.zip
	${_additional_source_url}/3bdf40c0d199af31923e900d082ca2dd-libfonts-1.1.6.zip
	${_additional_source_url}/ace6ab49184e329db254e454a010f56d-libxml-1.1.7.zip
	${_additional_source_url}/db60e4fde8dd6d6807523deb71ee34dc-liblayout-0.2.10.zip
	${_additional_source_url}/ba2930200c9f019c2d93a8c88c651a0f-flow-engine-0.9.4.zip
	http://download.go-oo.org/src/7a0dcb3fe1e8c7229ab4fb868b7325e6-mdds_0.5.2.tar.bz2
	http://download.go-oo.org/src/9e436bff44c60dc8b97cba0c7fc11a5c-libwps-0.2.0.tar.bz2
	http://download.go-oo.org/extern/185d60944ea767075d27247c3162b3bc-unowinreg.dll
	http://download.go-oo.org/extern/b4cae0700aa1c2aef7eb7f345365e6f1-translate-toolkit-1.8.1.tar.bz2
	http://download.go-oo.org/src/451ccf439a36a568653b024534669971-ConvertTextToNumber-1.3.2.oxt
	http://download.go-oo.org/src/90401bca927835b6fbae4a707ed187c8-nlpsolver-0.9.tar.bz2
	buildfix_i116795.diff
	buildfix_kde4.diff
	buildfix_kde4_2.diff
	buildfix_ct2n.diff
	old-install-behaviour.diff)
noextract=(185d60944ea767075d27247c3162b3bc-unowinreg.dll
	b4cae0700aa1c2aef7eb7f345365e6f1-translate-toolkit-1.8.1.tar.bz2
	7a0dcb3fe1e8c7229ab4fb868b7325e6-mdds_0.5.2.tar.bz2
	ada24d37d8d638b3d8a9985e80bc2978-source-9.0.0.7-bj.zip
	798b2ffdc8bcfe7bca2cf92b62caf685-rhino1_5R5.zip
	1f24ab1d39f4a51faf22244c94a6203f-xmlsec1-1.2.14.tar.gz
	128cfc86ed5953e57fe0f5ae98b62c2e-libtextcat-2.2.tar.gz
	9e436bff44c60dc8b97cba0c7fc11a5c-libwps-0.2.0.tar.bz2
	fdb27bfe2dbe2e7b57ae194d9bf36bab-SampleICC-1.3.2.tar.gz
	35c94d2df8893241173de1d16b6034c0-swingExSrc.zip
	2a177023f9ea8ec8bd00837605c5df1b-jakarta-tomcat-5.0.30-src.tar.gz
	a7983f859eafb2677d7ff386a023bc40-xsltml_2.1.2.zip
	3c219630e4302863a9a83d0efde889db-commons-logging-1.1.1-src.tar.gz
	2ae988b339daec234019a7066f96733e-commons-lang-2.3-src.tar.gz
	2c9b0f83ed5890af02c0df1c1776f39b-commons-httpclient-3.1-src.tar.gz
	af3c3acf618de6108d65fcdc92b492e1-commons-codec-1.3-src.tar.gz
	eeb2c7ddf0d302fba4bfc6e97eac9624-libbase-1.1.6.zip
	39bb3fcea1514f1369fcfc87542390fd-sacjava-1.3.zip
	3404ab6b1792ae5f16bbd603bd1e1d03-libformula-1.1.7.zip
	97b2d4dba862397f446b217e2b623e71-libloader-1.1.6.zip
	f94d9870737518e3b597f9265f4e9803-libserializer-1.1.6.zip
	8ce2fcd72becf06c41f7201d15373ed9-librepository-1.1.6.zip
	d8bd5eed178db6e2b18eeed243f85aa8-flute-1.1.6.zip
	3bdf40c0d199af31923e900d082ca2dd-libfonts-1.1.6.zip
	ace6ab49184e329db254e454a010f56d-libxml-1.1.7.zip
	db60e4fde8dd6d6807523deb71ee34dc-liblayout-0.2.10.zip
	ba2930200c9f019c2d93a8c88c651a0f-flow-engine-0.9.4.zip
	451ccf439a36a568653b024534669971-ConvertTextToNumber-1.3.2.oxt
	90401bca927835b6fbae4a707ed187c8-nlpsolver-0.9.tar.bz2)
md5sums=('3dec32be5e6d9de3c4c5d549cec6e9e3'
         'cb1f4e5005a2fd82a85b1982d172a8c0'
         '1840a6c219b1f68460529204bb396c7a'
         '7226e5b612313b4e99ccf14cb9ef112b'
         '4fe16642e5e0c55a1e53d1b44492a905'
         '4eedbc23115d2a6ef491870b02c87953'
         '84a392a8e027b354cd7cf5e637599d3e'
         'e3bf7eb4b7d051ee8c7884ac3526c43f'
         '0c4267a389d99aaa7b13ba5db3385072'
         'a5ac8c59961c0f46164856b0a6885b30'
         '2b058457f61505485aca3212cc30f842'
         'c111fa94966e0dfbf8106c95a41e0d52'
         '100506fcf623bbaa650b38ee1fdd7f12'
         'c226739110eb805a39b878de6f728ee3'
         'bc39162ea42554218fe0402363a8be03'
         '1e5d84bc356cca313979f44a7fb323d5'
         'e89038bbbb4a4f728eed14e4f95b9abb'
         '487ffc59476f9e7c5940277096e42c08'
         'ac5692709b11c061849290e31b80fbd2'
         '659adf30d4e614d51f482947c1d1121e'
         '128cfc86ed5953e57fe0f5ae98b62c2e'
         '1f24ab1d39f4a51faf22244c94a6203f'
         '35c94d2df8893241173de1d16b6034c0'
         '798b2ffdc8bcfe7bca2cf92b62caf685'
         'fdb27bfe2dbe2e7b57ae194d9bf36bab'
         'ada24d37d8d638b3d8a9985e80bc2978'
         '2a177023f9ea8ec8bd00837605c5df1b'
         'a7983f859eafb2677d7ff386a023bc40'
         '3c219630e4302863a9a83d0efde889db'
         '2ae988b339daec234019a7066f96733e'
         '2c9b0f83ed5890af02c0df1c1776f39b'
         'af3c3acf618de6108d65fcdc92b492e1'
         'eeb2c7ddf0d302fba4bfc6e97eac9624'
         '39bb3fcea1514f1369fcfc87542390fd'
         '3404ab6b1792ae5f16bbd603bd1e1d03'
         '97b2d4dba862397f446b217e2b623e71'
         'f94d9870737518e3b597f9265f4e9803'
         '8ce2fcd72becf06c41f7201d15373ed9'
         'd8bd5eed178db6e2b18eeed243f85aa8'
         '3bdf40c0d199af31923e900d082ca2dd'
         'ace6ab49184e329db254e454a010f56d'
         'db60e4fde8dd6d6807523deb71ee34dc'
         'ba2930200c9f019c2d93a8c88c651a0f'
         '7a0dcb3fe1e8c7229ab4fb868b7325e6'
         '9e436bff44c60dc8b97cba0c7fc11a5c'
         '185d60944ea767075d27247c3162b3bc'
         'b4cae0700aa1c2aef7eb7f345365e6f1'
         '451ccf439a36a568653b024534669971'
         '90401bca927835b6fbae4a707ed187c8'
         '0520d63c946e272ed3bdfc863fbdc42e'
         '765cdd3c64b332e5c279b8ecd9663936'
         '6eb230c49f747c0b9e74d0cfb0c8ef38'
         'eee273f501ff45dc5f1365e78c6d57c0'
         '3c4dd8a4a35aee7feca9dd5c2a80a999')

build() {

	unset J2REDIR; unset J2SDKDIR; unset JAVA_HOME; unset CLASSPATH
	[ -z "${JAVA_HOME}" ] && . /etc/profile.d/openjdk6.sh
	[ -z "${MOZ_PLUGIN_PATH}" ] && . /etc/profile.d/mozilla-common.sh
	[ -z "${ANT_HOME}" ] && . /etc/profile.d/apache-ant.sh

	# move all LibO sources into one build directory
	mkdir ${srcdir}/build && cd ${srcdir}/build
	for i in libreoffice-{artwork,base,bootstrap,calc,components,extensions,extras,filters,help,impress,libs-core,libs-extern,libs-extern-sys,libs-gui,postprocess,sdk,testing,translations,ure,writer}-${_LOver}; do
	  mv ${srcdir}/$i/* .
	done

	# move external sources into place
	mkdir ${srcdir}/ext_sources &&	cd ${srcdir}/ext_sources
	for source in "${noextract[@]}"; do
	  ln -s ${srcdir}/$source .
	done

	cd ${srcdir}/build

	# buildfixes & bugfixes
	patch -Np1 -i ${srcdir}/buildfix_i116795.diff
	patch -Np1 -i ${srcdir}/buildfix_kde4.diff
	patch -Np1 -i ${srcdir}/buildfix_kde4_2.diff
	patch -Np1 -i ${srcdir}/buildfix_ct2n.diff
	patch -Np1 -i ${srcdir}/old-install-behaviour.diff
	
	# unset C(XX)FLAGS
	# http://www.openoffice.org/issues/show_bug.cgi?id=103205
	unset CFLAGS
	unset CXXFLAGS

	# python2 fix
	export PYTHON=python2

	# fix dekstop menu entries
#	sed -i -e "s/Exec=oo/Exec=lo/g" desktop/*.desktop.in.in
#	sed -i -e "s/TryExec=oo/TryExec=lo/g" desktop/*.desktop.in.in
#	
	# http://wiki.documentfoundation.org/Development/How_to_build/Configure_options

	if [ "$CARCH" = "x86_64" ]; then
	      EXTRAOPTS="--without-stlport"
	 else 
	      EXTRAOPTS="--with-stlport" # --without-system-boost"
	      # # avoid problems with ixion for now
#	      sed -i '/fields-table-formula.diff/d' patches/dev300/apply || return 1
	fi

	autoconf -v
	./configure --with-build-version="${_LOver} ArchLinux build-${pkgrel}" \
		--with-unix-wrapper="libreoffice" \
		--with-max-jobs=${MAKEFLAGS/-j/} \
		--with-external-tar="${srcdir}/ext_sources" \
		--prefix=/usr --exec-prefix=/usr --sysconfdir=/etc \
		--with-install-dirname="${pkgbase}" --libdir=/usr/lib --mandir=/usr/share/man \
		--with-lang="" \
		--enable-cairo\
		--enable-crashdump\
		--enable-evolution2\
		--disable-graphite\
		--disable-gio\
		--disable-gnome-vfs\
		--disable-kde\
		--enable-kde4\
		--enable-ldap \
		--enable-lockdown\
		--enable-opengl \
		--enable-odk\
		--enable-opengl\
		--enable-ext-presenter-minimizer \
		--enable-ext-pdfimport \
		--enable-ext-presenter-console \
		--enable-ext-report-builder\
		--enable-ext-wiki-publisher \
		--enable-ext-ct2n \
		--enable-ext-hunart \
		--enable-ext-nlpsolver \
		--enable-ext-numbertext \
		--enable-ext-oooblogger \
		--enable-ext-typo \
		--enable-ext-watch-window \
		--enable-ext-diagram \
		--without-fonts\
		--without-afms\
		--without-ppds\
		--without-system-libwps\
		--without-system-mdds\
		--without-myspell-dicts \
		--with-system-dicts \
		--with-external-dict-dir=/usr/share/hunspell \
		--with-external-hyph-dir=/usr/share/hyphen \
		--with-external-thes-dir=/usr/share/mythes \
		--with-system-cppunit\
		--with-system-libwpg\
		--with-system-redland\
		--without-system-saxon\
		--without-system-libtextcat\
		--with-openldap\
		--with-ant-home="/usr/share/java/apache-ant"\
		--with-system-boost\
		--with-system-cairo\
		--with-system-libs\
		--with-system-mozilla\
		--with-system-mythes\
		--with-system-xrender-headers\
		--with-system-headers\
		--with-alloc=system\
		--with-system-lucene\
		--with-lucene-core-jar=/usr/share/java/lucene-core.jar\
		--with-lucene-analyzers-jar=/usr/share/java/lucene-analyzers.jar\
		$EXTRAOPTS || return 1

#--enable-ext-mysql-connector
#--with-system-graphite --enable-graohite ?
#--enable-dbus 
#--enable-gio ?
#--with-servlet-api-jar=JARFILE 
#checking whether to build extension for support of scripts in BeanShell... no
#checking whether to build extension for support of scripts in JavaScript... no
#checking whether to build extension for support of scripts in Python... no
#checking whether to enable KDE address book support... no
#checking whether to include MathMLDTD... yes
#checking which themes to include...  default crystal hicontrast oxygen tango
#checking for helppack integration... integration
#checking for extensions integration... no integration
#checking for Lightproof extensions integration (only supported languages displayed)... no integration
#checking for Watch Window extension integration... yes
#checking for Diagram extension integration... yes
#checking for Validator extension integration... no
#checking for Barcode extension integration... no
#checking for ConvertTextToNumber extension integration... yes
#checking for Numbertext extension integration... yes
#checking for Hungarian Cross-reference Toolbar extension integration... yes
#checking for Typography Toolbar extension integration... yes
#checking for Google Docs extension integration... no
#checking for NLPSolver extension integration... yes
#checking for LanguageTool extension integration... no
#checking for oooblogger extension integration... yes
#checking for Sun Professional Template Pack integration (only supported languages displayed)... no integration
#checking whether to include third-party fonts... no
#checking whether to include Agfa Monotype fonts... no
#checking whether to include PPDs... no
#checking whether to include AFMs... no
#checking whether to include extra galleries... no
#checking whether to include extra templates... no
#checking whether to include extra samples... no
#checking whether to include extra fonts... no
#checking whether and how to use Xinerama... yes, with dynamic linking
#checking for vendor... not set
#checking for UNIX wrapper name... not set
#checking whether to statically link to Gtk... no
#checking whether to use layout dialogs... no
#checking build verbosity... not set

# see http://qa.openoffice.org/issues/show_bug.cgi?id=110136
#		--with-system-saxon\
#		--with-saxon-jar=/usr/share/java/saxon/saxon9he.jar\
		
#		--enable-report-builder \	
#		--with-additional-sections="OOXMLExport"

#		--with-languagetool \
#		--with-lightproof \
#		--with-validator \
#		--with-barcode \

	touch src.downloaded
	#./download
	unset MAKEFLAGS
	./bootstrap
	make
}

#check() {
#	cd ${srcdir}/build
#	make check
#}

package_libreoffice() {

 pkgdesc="a productivity suite that is compatible with other major office suites"
 install=${pkgbase}.install
 depends=("curl>=7.20.0" "hunspell>=1.2.8" "python2>=2.7" 'libwpd>=0.9.0' 'libxaw' "neon>=0.28.6"
          'pango' 'nspr' 'libjpeg' 'libxrandr' 'libgl' 'dbus-glib' "icu>=4.6" 'libxslt'
          'redland' 'libgraphite' 'hyphen' 'lpsolve' 'gcc-libs' 'sh'
          'hicolor-icon-theme' 'desktop-file-utils' 'shared-mime-info' 'java-runtime' 'gtk2') # keep gtk2 for install script
          #'saxon'
 optdepends=( #'java-runtime:     adds java support'
             'libcups:          adds printing support'
             'gconf:            adds additional gnome support'
             'nss:              adds support for signed files/macros'
             'pstoedit:         translates PostScript and PDF graphics into other vector formats'
             'poppler:          for shipped pdfimport extension'
             'kdelibs:          for kde integration'
             'libmythes:        for use in thesaurus'
             'hsqldb-java:      default database format for OpenOffice.org'
             'beanshell:        interactive java -- good for prototyping /macros'
             'vigra:            C++ computer vision library, usable in Basebmp'
             'libmspack:        library for Microsoft compression formats for use in FontOOo'
             'libwpg:           library for importing and converting Corel WordPerfect(tm) Graphics images'
             'libldap:          to get profiles via ldap'
             'lucene:           full-text search engine library for Java needed in the help section'
             'sane:             for scanner access'
             'unixodbc:         adds ODBC database support'
             'mesa:             for the OGLTrans extension'
             'gstreamer0.10-base: + some gstr-plugins to support multimedia content, e.g. in impress')
#             'mono:             allows UNO automation with Mono'
 backup=(etc/libreoffice/sofficerc
         etc/libreoffice/bootstraprc
         etc/libreoffice/psprint.conf)
 provides=('go-openoffice') #'openoffice-base' 
 conflicts=('go-openoffice') #'openoffice-base' 
 replaces=('go-openoffice' 'openoffice-base' )

	cd ${srcdir}/build
	#bin/ooinstall <path-to-install>
	#make OODESTDIR=${pkgdir} install
	make DESTDIR=${pkgdir} install

	# move sysui desktop files into place we want to use - javafilter and qstarter, but not unneeded printeradmin
	cp ${pkgdir}/usr/lib/libreoffice/share/xdg/javafilter.desktop ${pkgdir}/usr/share/applications/
	sed -i -e "s/Exec=oo/Exec=so/g" ${pkgdir}/usr/share/applications/javafilter.desktop # https://bugs.archlinux.org/task/23361
	cp ${pkgdir}/usr/lib/libreoffice/share/xdg/qstart.desktop ${pkgdir}/usr/share/applications/
	# remove version in menu entry and make it visible
	sed -i -e "s/3.3 Quickstarter/Quickstarter/g" ${pkgdir}/usr/share/applications/qstart.desktop
	sed -i -e "/NoDisplay=true/d" ${pkgdir}/usr/share/applications/qstart.desktop
	# remove unneeded .desktop files from vanilla sysui
	rm -rf ${pkgdir}/usr/lib/libreoffice/share/xdg

	# put configuration files into place
	install -dm755 ${pkgdir}/etc/libreoffice
	install -m644 ${pkgdir}/usr/lib/libreoffice/program/{bootstraprc,sofficerc} ${pkgdir}/etc/libreoffice/
	install -m644 ${pkgdir}/usr/lib/libreoffice/basis3.3/share/psprint/psprint.conf ${pkgdir}/etc/libreoffice/
	# install dummy links to make them found by LibO
	cd ${pkgdir}/usr/lib/libreoffice/program/
	ln -vsf /etc/libreoffice/{bootstraprc,sofficerc} .
	cd ${pkgdir}/usr/lib/libreoffice/basis3.3/share/psprint/
	ln -vsf /etc/libreoffice/psprint.conf .
 
	#fix http://bugs.archlinux.org/task/17656
	find ${pkgdir} -perm 444 -exec ls -lh {} \; 
	find ${pkgdir} -perm 444 -exec chmod 644 {} \;
	find ${pkgdir} -perm 555 -exec ls -lh {} \;
	find ${pkgdir} -perm 555 -exec chmod 755 {} \;
	
	# split out extensions
	mv ${pkgdir}/usr/lib/libreoffice/share/extensions ${srcdir}/extensions-install
	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	install -m644 ${srcdir}/extensions-install/package.txt ${pkgdir}/usr/lib/libreoffice/share/extensions/

	# move SDK to separated package
	mkdir -p ${srcdir}/sdk-install/usr/lib/libreoffice/basis3.3/sdk
	mv ${pkgdir}/usr/lib/libreoffice/basis3.3/sdk ${srcdir}/sdk-install/usr/lib/libreoffice/basis3.3/

	mkdir -p ${srcdir}/sdk-install/usr/share/doc/packages/libreoffice/sdk
	mv ${pkgdir}/usr/share/doc/packages/libreoffice/sdk ${srcdir}/sdk-install/usr/share/doc/packages/libreoffice/

	mkdir -p ${srcdir}/sdk-install/usr/share/libreoffice/sdk
	mv ${pkgdir}/usr/share/libreoffice/sdk ${srcdir}/sdk-install/usr/share/libreoffice/

	mkdir -p ${srcdir}/sdk-install/usr/share/idl/libreoffice
	mv ${pkgdir}/usr/share/idl/libreoffice ${srcdir}/sdk-install/usr/share/idl/

	mkdir -p ${srcdir}/sdk-install/usr/include/libreoffice
	mv ${pkgdir}/usr/include/libreoffice ${srcdir}/sdk-install/usr/include/
}

package_libreoffice-sdk() {

 pkgdesc="Software development kit for LibreOffice"
 depends=('libreoffice')

	cd ${srcdir}/sdk-install
	cp -r * ${pkgdir}

	cd ${pkgdir}/usr/lib/libreoffice/basis3.3/sdk
	for file in setsdkenv_unix.csh setsdkenv_unix.sh ; do
          chmod 755 $file
	done
	#fix permissions
	find examples -type f -exec chmod -x {} \;
}

package_libreoffice-extension-nlpsolver() {

 pkgdesc="This extension integrates into Calc and offers new Solver engines to use for optimizing nonlinear programming models"
 #arch=('any')
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/NLPSolver.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/nlpsolver
}

package_libreoffice-extension-pdfimport() {

 pkgdesc="This extension allows you to import and modify PDF documents"
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/pdfimport/pdfimport.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/pdfimport
}

package_libreoffice-extension-presentation-minimizer() {

 pkgdesc="This extension reduce the file size of the current presentation"
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/presentation-minimizer.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/presentation-minimizer
}

package_libreoffice-extension-presenter-screen() {

 pkgdesc="This extension provides more control over your slide show presentation, such as the ability to see the upcoming slide, the slide notes, and a presentation timer whereas the audience see only the current slide"
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/presenter/presenter-screen.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/presenter-screen
}

package_libreoffice-extension-report-builder() {

 pkgdesc="This extension creates smart-looking database reports"
 #arch=('any')
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/report-builder.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/report-builder
}

package_libreoffice-extension-wiki-publisher() {

 pkgdesc="This extension enables you to create Wiki articles on MediaWiki servers without having to know the syntax of the MediaWiki markup language"
 #arch=('any')
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/wiki-publisher.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/wiki-publisher
}

package_libreoffice-extension-ct2n() {

 pkgdesc="This extension enables you to convert text-cells in Calc with numbers and dates, to real numbers and dates."
 #arch=('any')
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/ConvertTextToNumber.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/ct2n
}

package_libreoffice-extension-hunart() {

 pkgdesc="Hungarian cross-reference toolbar extension"
 #arch=('any')
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/hunart.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/hunart
}

package_libreoffice-extension-numbertext() {

 pkgdesc="NUMBERTEXT/MONEYTEXT extensions"
 #arch=('any')
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/numbertext.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/numbertext
}

package_libreoffice-extension-oooblogger() {

 pkgdesc="An extensions for blogging"
 #arch=('any')
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/oooblogger.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/oooblogger
}

package_libreoffice-extension-typo() {

 pkgdesc="Typography toolbar extension"
 #arch=('any')
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/typo.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/typo
}

package_libreoffice-extension-watch-window() {

 pkgdesc="A OOo Calc extension to add a Watch Window, which keeps the value of the monitored cell on the screen."
 #arch=('any')
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/WatchWindow.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/watch-window
}

package_libreoffice-extension-diagram() {

 pkgdesc="An OOo Draw and Impress extension that creates your favorite diagrams with a few clicks"
 #arch=('any')
 depends=('libreoffice')
 groups=('libreoffice-extensions')

	install -dm755 ${pkgdir}/usr/lib/libreoffice/share/extensions
	unzip ${srcdir}/solver/${_OFFICEUPD}/unxlng*/bin/Diagram.oxt -d ${pkgdir}/usr/lib/libreoffice/share/extensions/diagram
}
