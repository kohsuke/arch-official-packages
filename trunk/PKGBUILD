# $Id$
# Maintainer: Guillaume ALAUX <guillaume at alaux dot net>

pkgname=wireshark
pkgver=1.4.0
pkgrel=2
pkgdesc="A free network protocol analyzer for Unix/Linux and Windows"
arch=('i686' 'x86_64')
license=('GPL2')
depends=('gtk2' 'heimdal' 'libpcap' 'bash' 'gnutls' 'libcap')
makedepends=('bison' 'flex')
url="http://www.wireshark.org/"
install=wireshark.install
options=(!libtool)
source=(http://www.wireshark.org/download/src/${pkgname}-${pkgver}.tar.bz2 wireshark.desktop wireshark.png)
md5sums=('13b188baea23cdad40b7a55921384a77'
         '504ede44c02b2a52f6cbd3bffdf93b8d'
         'e771800a8c977fe223583a453bc27397')

build() {
  cd ${srcdir}/${pkgname}-${pkgver}
  export CFLAGS="-fno-unit-at-a-time ${CFLAGS}"

  ./configure --prefix=/usr --with-ssl
  make all
  make DESTDIR=${pkgdir} install

  install -Dm644 ${srcdir}/wireshark.png ${pkgdir}/usr/share/icons/wireshark.png
  install -Dm644 ${srcdir}/wireshark.desktop ${pkgdir}/usr/share/applications/wireshark.desktop
  #wireshark uid group is 150
  chgrp 150 "${pkgdir}/usr/bin/dumpcap"
  chmod 754 "${pkgdir}/usr/bin/dumpcap"
}
