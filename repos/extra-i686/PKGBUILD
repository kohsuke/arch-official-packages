# $Id$
# Maintainer : Tobias Powalowski <tpowa@archlinux.org>

_kernver=2.6.27-ARCH;

pkgname=intel-537
pkgver=2.60.80.0
pkgrel=58
pkgdesc="Intel Modem Drivers for 537 chipsets. For stock arch 2.6 kernel"
arch=(i686 x86_64)
license=('custom:"INTEL537"')
url="http://linmodems.technion.ac.il/packages/Intel/"
depends=('intel-537-utils' 'kernel26>=2.6.27-1' 'kernel26<2.6.28')
source=(http://linmodems.technion.ac.il/packages/intel/Philippe.Vouters/intel-537EP_secure-2.60.80.0_2008_03_22.tar.bz2
	kernel-2.6.26.patch
	kernel-2.6.27.patch)
install=intel-537.install

build() {
  cd $srcdir/intel-537EP_secure-2.60.80.0
  # fix makefile
  sed -i -e "s/\`uname -r\`/${_kernver}/g" makefile
  sed -i -e "s/\`uname -r\`/${_kernver}/g" config_check
  patch -Np0 -i ../kernel-2.6.26.patch || return 1
  patch -Np1 -i ../kernel-2.6.27.patch || return 1
  make KDIR=/lib/modules/${_kernver}/build KERNEL_SOURCE_PATH=/lib/modules/${_kernver}/build MODEM_TYPE=537 537 || return 1
  # Install kernel module
  install -D -m 644 Intel537.ko $pkgdir/lib/modules/${_kernver}/kernel/drivers/net/intel537.ko || return 1
  sed -i -e "s/KERNEL_VERSION=.*/KERNEL_VERSION=${_kernver}/g" $startdir/intel-537.install
 }
md5sums=('f7f51cef6eac2b2b5e260c1747e025c6'
         '8c8d0e85490194595cc4d80bc3da969c'
         '787967a6bc3b371744f4262af32b2bed')
