# $Id$
# Maintainer : Tobias Powalowski <tpowa@archlinux.org>

_kernver=2.6.26-ARCH;

pkgname=intel-537
pkgver=2.60.80.0
pkgrel=57
pkgdesc="Intel Modem Drivers for 537 chipsets. For stock arch 2.6 kernel"
arch=(i686 x86_64)
license=('custom:"INTEL537"')
url="http://linmodems.technion.ac.il/packages/Intel/"
depends=('intel-537-utils' 'kernel26>=2.6.26-1' 'kernel26<2.6.27')
source=(http://downloadmirror.intel.com/9284/eng/Intel-537EP-2.70.95.0-suse9.3.tgz flip.patch compile.patch \
	module-parm.patch pm_unregister.patch asmlinkage.patch kernel-2.6.19.patch kernel-2.6.20.patch kernel-2.6.24.patch kernel-2.6.26.patch)
install=intel-537.install

build() {
  cd $startdir/src/Intel-537
  patch -Np0 -i ../flip.patch || return 1
  patch -Np0 -i ../compile.patch || return 1
  patch -Np1 -i ../module-parm.patch || return 1
  patch -Np1 -i ../pm_unregister.patch || return 1
  patch -Np1 -i ../asmlinkage.patch || return 1
  patch -Np0 -i ../kernel-2.6.19.patch || return 1
  patch -Np0 -i ../kernel-2.6.20.patch || return 1
  patch -Np0 -i ../kernel-2.6.24.patch || return 1
  patch -Np0 -i ../kernel-2.6.26.patch || return 1
  # fix makefile
  sed -i -e "s/\`uname -r\`/${_kernver}/g" makefile
  sed -i -e "s/\`uname -r\`/${_kernver}/g" config_check
  make KDIR=/lib/modules/${_kernver}/build KERNEL_SOURCE_PATH=/lib/modules/${_kernver}/build 537 || return 1
  # Install kernel module
  install -D -m 644 Intel537.ko $startdir/pkg/lib/modules/${_kernver}/kernel/drivers/net/intel537.ko || return 1
  sed -i -e "s/KERNEL_VERSION=.*/KERNEL_VERSION=${_kernver}/g" $startdir/intel-537.install
 }
md5sums=('1740a05c0ce039633f2dd65b055604b0'
         'c459529b418a72d810f1c17b74ad24ac'
         '2cea9fefc9844518f40a55f0c26a4714'
         '24cdd2988a87075a4cb3a5de0ea118d5'
         '4925209a57fcf7994d4436629f50a4da'
         '288aa5d8fb6817c5de2119c6c8d3f27a'
         '63bc7e293d012e5c6f6110c992da14a2'
         'dfa22d3419daf52bd85c258702bcee3d'
         '62ac61024d0df2ed99ae3e2c212420be'
         '3b7439390784516c707712c07e15774b')
