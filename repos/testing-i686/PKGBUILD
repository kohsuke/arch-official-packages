# $Id$
# Maintainer: Hugo Doria <hugo@archlinux.org>

pkgname=wireshark
pkgver=1.2.4
pkgrel=1
pkgdesc="A free network protocol analyzer for Unix/Linux and Windows"
arch=('i686' 'x86_64')
license=('GPL2')
depends=('gtk2>=2.18' 'heimdal>=1.3.1' 'libpcap>=1.0.0' 'bash' 'gnutls>=2.4.1' 'libcap>=2.16')
makedepends=('bison' 'flex')
url="http://www.wireshark.org/"
replaces=('ethereal')
options=(!libtool)
source=(http://www.wireshark.org/download/src/${pkgname}-${pkgver}.tar.gz wireshark.desktop wireshark.png wireshark-1.1.2--as-needed.patch)

build() {
  cd ${srcdir}/${pkgname}-${pkgver}
  export CFLAGS="-fno-unit-at-a-time ${CFLAGS}"

  patch -Np1 -i $srcdir/wireshark-1.1.2--as-needed.patch || return 1
  autoreconf -f -i || return 1

  ./configure --prefix=/usr --with-ssl || return 1
  make all || return 1
  make DESTDIR=${pkgdir} install || return 1

  install -Dm644 ${srcdir}/wireshark.png ${pkgdir}/usr/share/icons/wireshark.png
  install -Dm644 ${srcdir}/wireshark.desktop ${pkgdir}/usr/share/applications/wireshark.desktop
}
sha256sums=('ede4ffefd8c47e8560c2b15ad2b555c30eff1ce52a1a3049deb085fa346377ac'
            '10c8b5bdd1d161454c93df166f39b2bae72efe6021beb61d84dd65dc329260fe'
            'a9f6d78dd64a87acd1b600222156b9fc26e7ccbbc43fc77c1da138908bdb2d3c'
            '34aa27c611021c9a515cc4fed9778148395761bf6f4272130d3e83abcc13a499')
