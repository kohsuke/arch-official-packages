diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/handlebuttoneventsconfig.cpp ../powerdevil/daemon/actions/bundled/handlebuttoneventsconfig.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/handlebuttoneventsconfig.cpp	2010-11-11 06:40:47.000000000 -0800
+++ ../powerdevil/daemon/actions/bundled/handlebuttoneventsconfig.cpp	2010-12-17 12:00:44.800005102 -0800
@@ -54,8 +54,8 @@
 
 void HandleButtonEventsConfig::load()
 {
-    m_lidCloseCombo->setCurrentIndex(configGroup().readEntry< uint >("lidAction", 0));
-    m_powerButtonCombo->setCurrentIndex(configGroup().readEntry< uint >("powerButtonAction", 0));
+    m_lidCloseCombo->setCurrentIndex(m_lidCloseCombo->findData(QVariant::fromValue(configGroup().readEntry< uint >("lidAction", 0))));
+    m_powerButtonCombo->setCurrentIndex(m_powerButtonCombo->findData(QVariant::fromValue(configGroup().readEntry< uint >("powerButtonAction", 0))));
 }
 
 QList< QPair< QString, QWidget* > > HandleButtonEventsConfig::buildUi()
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevilbrightnesscontrolaction.desktop ../powerdevil/daemon/actions/bundled/powerdevilbrightnesscontrolaction.desktop
--- kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevilbrightnesscontrolaction.desktop	2010-12-01 14:22:39.000000000 -0800
+++ ../powerdevil/daemon/actions/bundled/powerdevilbrightnesscontrolaction.desktop	2010-12-17 12:00:44.800005102 -0800
@@ -12,7 +12,9 @@
 Name[es]=Brillo de la pantalla
 Name[et]=Monitori heledus
 Name[hr]=Osvjetljenje ekrana
+Name[hu]=Fényerő
 Name[ia]=Monstrar Brillantia
+Name[it]=Mostra la luminosità
 Name[kk]=Дисплейдің жарықтығы
 Name[km]=ពន្លឺ​នៃ​ការ​បង្ហាញ
 Name[ko]=디스플레이 밝기
@@ -37,6 +39,7 @@
 Comment[es]=Control básico del brillo
 Comment[et]=Heleduse lihtne juhtimine
 Comment[ia]=Controlos basic pro brillantia
+Comment[it]=Controlli fondamentali della luminosità
 Comment[kk]=Жарықтығының негізгі тұтқалары
 Comment[km]=ការ​ត្រួតពិនិត្យ​ពន្លឺ​ជា​មូលដ្ឋាន
 Comment[ko]=기본 밝기 제어
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevildimdisplayaction.desktop ../powerdevil/daemon/actions/bundled/powerdevildimdisplayaction.desktop
--- kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevildimdisplayaction.desktop	2010-12-01 14:22:39.000000000 -0800
+++ ../powerdevil/daemon/actions/bundled/powerdevildimdisplayaction.desktop	2010-12-17 12:00:44.803338435 -0800
@@ -11,7 +11,9 @@
 Name[en_GB]=Dim Display
 Name[es]=Atenuación de pantalla
 Name[et]=Heleduse tumendamine
+Name[hu]=Képernyő elsötétítése
 Name[ia]=Obscurar Monstrator
+Name[it]=Scurisci lo schermo
 Name[ja]=ディスプレイを暗くする
 Name[kk]=Дисплей жарықтығын азайту
 Name[km]=ការ​បង្ហាញ​ព្រិលៗ
@@ -37,6 +39,7 @@
 Comment[es]=Atenúa la pantalla gradualmente según pasa el tiempo
 Comment[et]=Kuva järkjärguline tumendamine aega arvestades
 Comment[ia]=Obscurar gradualmente le monstrator usante como base le tempore
+Comment[it]=Scurisce gradualmente lo schermo su base temporale
 Comment[ja]=ディスプレイを時間とともに徐々に暗くする
 Comment[kk]=Дисплей жарықтығын біртіндеп азайту
 Comment[km]=ធ្វើ​ឲ្យ​​ការ​បង្ហាញ​ព្រិល​ៗ​ទៅ​តាម​​ពេលវេលា​
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevildisabledesktopeffectsaction.desktop ../powerdevil/daemon/actions/bundled/powerdevildisabledesktopeffectsaction.desktop
--- kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevildisabledesktopeffectsaction.desktop	2010-12-01 14:22:39.000000000 -0800
+++ ../powerdevil/daemon/actions/bundled/powerdevildisabledesktopeffectsaction.desktop	2010-12-17 12:00:44.803338435 -0800
@@ -13,6 +13,7 @@
 Name[et]=Töölauaefektide keelamine
 Name[hu]=Asztali effektek kikapcsolása
 Name[ia]=Dis-habilitar Effectos de Scriptorio
+Name[it]=Disattiva gli effetti del desktop
 Name[ja]=デスクトップ効果を無効にする
 Name[kk]=Үстел эффекттерін бұғаттау
 Name[km]=បិទ​បែបផែន​ផ្ទៃ​តុ​
@@ -39,6 +40,7 @@
 Comment[et]=KWini töölauaefektide ajutine väljalülitamine
 Comment[hr]=Privremeno onemogućuje KWinove efekte radne površine
 Comment[ia]=Temporaneemente  il dis-habilita effectos de scriptorio de KWin
+Comment[it]=Disattiva temporaneamente gli effetti del desktop di KWin
 Comment[ja]=一時的に KWin のデスクトップ効果を無効にします
 Comment[kk]=KWin үстел эффекттерін уақытша доғару
 Comment[km]=បិទ​បែបផែន​ផ្ទៃតុ​របស់ KWin ជា​បណ្ដោះអាសន្ន
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevilhandlebuttoneventsaction.desktop ../powerdevil/daemon/actions/bundled/powerdevilhandlebuttoneventsaction.desktop
--- kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevilhandlebuttoneventsaction.desktop	2010-12-01 14:22:39.000000000 -0800
+++ ../powerdevil/daemon/actions/bundled/powerdevilhandlebuttoneventsaction.desktop	2010-12-17 12:00:44.800005102 -0800
@@ -12,6 +12,7 @@
 Name[es]=Gestión de eventos de botón
 Name[et]=Nupusündmuste kohtlemine
 Name[ia]=Button maneante de eventos
+Name[it]=Gestione degli eventi dei pulsanti
 Name[kk]=Батырма басуға көңіл болу
 Name[km]=ការ​គ្រប់គ្រង​ប៊ូតុង​​ព្រឹត្តិការណ៍​​
 Name[ko]=단추 이벤트 처리
@@ -35,6 +36,7 @@
 Comment[es]=Realiza una acción cuando se presiona un botón
 Comment[et]=Toimingu sooritamine, kui vajutatakse nuppu
 Comment[ia]=Il executa un action quando un button es pressate
+Comment[it]=Effettua un'azione ogni volta che viene premuto un pulsante
 Comment[kk]=Әрқашанда батырмасы басылғанда әрекетін орындау
 Comment[km]=អនុវត្ត​សកម្មភាព​នៅពេល​ដែល​ចុច​ប៊ូតុង
 Comment[ko]=단추가 눌렸을 때 동작을 실행합니다
@@ -46,6 +48,7 @@
 Comment[pt]=Efectua uma acção quando carregar num botão
 Comment[pt_BR]=Executa uma ação sempre que um botão é pressionado
 Comment[sv]=Utför en åtgärd så fort en knapp trycks ner
+Comment[th]=ดำเนินการการกระทำเมื่อกดปุ่ม
 Comment[uk]=Виконання дій у відповідь на натискання кнопки
 Comment[x-test]=xxPerforms an action whenever a button is pressedxx
 Comment[zh_TW]=按鍵被按下時執行動作
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevilrunscriptaction.desktop ../powerdevil/daemon/actions/bundled/powerdevilrunscriptaction.desktop
--- kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevilrunscriptaction.desktop	2010-12-01 14:22:39.000000000 -0800
+++ ../powerdevil/daemon/actions/bundled/powerdevilrunscriptaction.desktop	2010-12-17 12:00:44.803338435 -0800
@@ -14,6 +14,7 @@
 Name[hr]=Pokreni skriptu
 Name[hu]=Parancsfájl futtatása
 Name[ia]=Exequer Script
+Name[it]=Avvia script
 Name[ja]=スクリプトを実行
 Name[kk]=Скриптті орындау
 Name[km]=ដំណើរការ​ស្គ្រីប
@@ -41,6 +42,7 @@
 Comment[hr]=Pokreće prilagođene skripte
 Comment[hu]=Egyéni parancsfájl futtatása
 Comment[ia]=Il exeque un script personalisate
+Comment[it]=Avvia uno script personalizzato
 Comment[ja]=カスタムスクリプトを実行
 Comment[kk]=Пайдаланушының скриптін орындау
 Comment[km]=ដំណើរការ​ស្គ្រីប​ផ្ទាល់ខ្លួន
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevilsuspendsessionaction.desktop ../powerdevil/daemon/actions/bundled/powerdevilsuspendsessionaction.desktop
--- kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/powerdevilsuspendsessionaction.desktop	2010-12-01 14:22:39.000000000 -0800
+++ ../powerdevil/daemon/actions/bundled/powerdevilsuspendsessionaction.desktop	2010-12-17 12:00:44.803338435 -0800
@@ -14,6 +14,7 @@
 Name[hr]=Obustavljanje sesije
 Name[hu]=Munkamenet felfüggesztése
 Name[ia]=Suspender Session
+Name[it]=Sospendi la sessione
 Name[ja]=セッションをサスペンド
 Name[kk]=Сеансын аялдату
 Name[km]=ផ្អាក​សម័យ
@@ -41,6 +42,7 @@
 Comment[hr]=Obustavljanje ove sesije
 Comment[hu]=A munkamenet felfüggesztése
 Comment[ia]=Il suspende le session
+Comment[it]=Sospende la sessione
 Comment[ja]=セッションをサスペンドします
 Comment[kk]=Сеансын тоқтата тұру
 Comment[km]=ផ្អាក​សម័យ
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/suspendsession.cpp ../powerdevil/daemon/actions/bundled/suspendsession.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/actions/bundled/suspendsession.cpp	2010-11-11 06:40:47.000000000 -0800
+++ ../powerdevil/daemon/actions/bundled/suspendsession.cpp	2010-12-17 12:00:44.803338435 -0800
@@ -20,6 +20,7 @@
 #include "suspendsession.h"
 
 #include "powerdevilbackendinterface.h"
+#include "powerdevilcore.h"
 
 #include <KConfigGroup>
 #include <KLocalizedString>
@@ -110,6 +111,7 @@
             KWorkSpace::requestShutDown(KWorkSpace::ShutdownConfirmYes);
             break;
         case LockScreenMode:
+            core()->emitNotification("doingjob", i18n("The screen is being locked"));
             lockScreenAndWait();
             break;
         default:
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/actions/dpms/powerdevildpmsaction.desktop ../powerdevil/daemon/actions/dpms/powerdevildpmsaction.desktop
--- kdebase-workspace-4.5.85/powerdevil//daemon/actions/dpms/powerdevildpmsaction.desktop	2010-12-01 14:22:39.000000000 -0800
+++ ../powerdevil/daemon/actions/dpms/powerdevildpmsaction.desktop	2010-12-17 12:00:44.753338434 -0800
@@ -12,6 +12,7 @@
 Name[es]=Ahorro de energía de la pantalla
 Name[et]=Ekraanisäästja
 Name[ia]=Sparnio de Energia de Schermo
+Name[it]=Risparmio energetico dello schermo
 Name[kk]=Экран қуатын үнемдеу
 Name[km]=សន្សំ​ថាមពល​អេក្រង់
 Name[ko]=화면 에너지 절약
@@ -36,6 +37,7 @@
 Comment[et]=Monitori toiteseadistused
 Comment[hr]=Kontrola DPMS postavki
 Comment[ia]=Preferentias de Controlos DPMS
+Comment[it]=Impostazioni dei controlli DPMS
 Comment[ja]=DPMS の設定
 Comment[kk]=DPMS параметрлерін басқару
 Comment[km]=ការ​កំណត់​វត្ថុ​បញ្ជា DPMS
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/actions/powerdevilaction.desktop ../powerdevil/daemon/actions/powerdevilaction.desktop
--- kdebase-workspace-4.5.85/powerdevil//daemon/actions/powerdevilaction.desktop	2010-12-01 14:22:39.000000000 -0800
+++ ../powerdevil/daemon/actions/powerdevilaction.desktop	2010-12-17 12:00:44.810005101 -0800
@@ -10,6 +10,7 @@
 Comment[en_GB]=Power Management Action Extension
 Comment[et]=Toitehalduse laiendus
 Comment[ia]=Extension de Action de Gestion de energia
+Comment[it]=Estensione delle azioni di gestione energetica
 Comment[kk]=Қуаттандыруды басқару әрекетін кеңейтуі
 Comment[km]=ផ្នែក​បន្ថែម​សកម្មភាព​គ្រប់គ្រង​ថាមពល
 Comment[ko]=전력 관리 동작 확장
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/BackendConfig.cmake ../powerdevil/daemon/BackendConfig.cmake
--- kdebase-workspace-4.5.85/powerdevil//daemon/BackendConfig.cmake	2010-11-25 09:40:32.000000000 -0800
+++ ../powerdevil/daemon/BackendConfig.cmake	2010-12-17 12:00:44.926671768 -0800
@@ -33,6 +33,13 @@
 
 set(powerdevilupowerbackend_LIBS ${X11_LIBRARIES} ${QT_QTGUI_LIBRARY} ${X11_Xrandr_LIB})
 
+## backlight helper executable
+kde4_add_executable(backlighthelper backends/upower/backlighthelper.cpp ${backlighthelper_mocs})
+target_link_libraries(backlighthelper ${KDE4_KDECORE_LIBS})
+install(TARGETS backlighthelper DESTINATION ${LIBEXEC_INSTALL_DIR})
+kde4_install_auth_helper_files(backlighthelper org.kde.powerdevil.backlighthelper root)
+kde4_install_auth_actions(org.kde.powerdevil.backlighthelper ${CMAKE_CURRENT_SOURCE_DIR}/backends/upower/backlight_helper_actions.actions)
+
 ########################## HAL Backend #####################################
 
 include_directories(${CMAKE_CURRENT_SOURCE_DIR}/backends/hal
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/backends/hal/powerdevilhalbackend.cpp ../powerdevil/daemon/backends/hal/powerdevilhalbackend.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/backends/hal/powerdevilhalbackend.cpp	2010-11-25 09:40:32.000000000 -0800
+++ ../powerdevil/daemon/backends/hal/powerdevilhalbackend.cpp	2010-12-17 12:00:44.913338435 -0800
@@ -22,6 +22,7 @@
 #include "powerdevilhalbackend.h"
 #include <Solid/DeviceNotifier>
 #include <QtDBus/QDBusReply>
+#include <QtDBus/QDBusConnectionInterface>
 #include <KDebug>
 #include "halsuspendjob.h"
 #include <Solid/Device>
@@ -63,11 +64,13 @@
 
 bool PowerDevilHALBackend::isAvailable()
 {
-    return m_halPowerManagement.isValid();
+    return QDBusConnection::systemBus().interface()->isServiceRegistered("org.freedesktop.Hal");
 }
 
 void PowerDevilHALBackend::init()
 {
+    setCapabilities(NoCapabilities);
+
     connect(Solid::DeviceNotifier::instance(), SIGNAL(deviceRemoved(const QString &)),
             this, SLOT(slotDeviceRemoved(const QString &)));
     connect(Solid::DeviceNotifier::instance(), SIGNAL(deviceAdded(const QString &)),
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/backends/hal/powerdevilhalbackend.desktop ../powerdevil/daemon/backends/hal/powerdevilhalbackend.desktop
--- kdebase-workspace-4.5.85/powerdevil//daemon/backends/hal/powerdevilhalbackend.desktop	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/daemon/backends/hal/powerdevilhalbackend.desktop	2010-12-17 12:00:44.900005101 -0800
@@ -12,7 +12,9 @@
 Name[en_GB]=HAL PowerDevil Backend
 Name[es]=Motor HAL para PowerDevil
 Name[et]=HAL-i PowerDevili taustaprogramm
+Name[hu]=HAL Powerdevil-modul
 Name[ia]=HAL PowerDevil Backend (retro-parte de PowerDevil de HAL)
+Name[it]=Motore PowerDevil per HAL
 Name[ja]=HAL PowerDevil バックエンド
 Name[kk]=HAL PowerDevil тетігі
 Name[km]=កម្មវិធី​ខាងក្រោយ HAL PowerDevil
@@ -38,6 +40,7 @@
 Comment[es]=Usar el sistema de gestión de energía de KDE mediante el demonio HAL de freedesktop.org
 Comment[et]=KDE toitehalduse süsteemi kasutamine freedesktop.org-i HAL-deemoni abil
 Comment[ia]=Usar systema de Gestion de Energia de KDE usante demone HAL de freedesktop.org
+Comment[it]=Usa il sistema di gestione energetica di KDE attraverso il demone HAL di freedesktop.org
 Comment[kk]=freedesktop.org HAL қызметі көмегімен KDE қуаттандыру жүйесін басқару
 Comment[km]=ប្រើ​ប្រព័ន្ធ​គ្រប់គ្រង​ថាមពល​របស់ KDE តាមរយៈ​ដេមិន freedesktop.org HAL
 Comment[ko]=freedesktop.org HAL 데몬을 사용하는 KDE 전력 관리 시스템
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/backends/hal/powerdevilhalbackend.h ../powerdevil/daemon/backends/hal/powerdevilhalbackend.h
--- kdebase-workspace-4.5.85/powerdevil//daemon/backends/hal/powerdevilhalbackend.h	2010-11-25 09:40:32.000000000 -0800
+++ ../powerdevil/daemon/backends/hal/powerdevilhalbackend.h	2010-12-17 12:00:44.900005101 -0800
@@ -46,7 +46,7 @@
     virtual ~PowerDevilHALBackend();
 
     virtual void init();
-    virtual bool isAvailable();
+    static bool isAvailable();
 
     virtual float brightness(BrightnessControlType type = Screen) const;
 
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/backlight_helper_actions.actions ../powerdevil/daemon/backends/upower/backlight_helper_actions.actions
--- kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/backlight_helper_actions.actions	1969-12-31 16:00:00.000000000 -0800
+++ ../powerdevil/daemon/backends/upower/backlight_helper_actions.actions	2010-12-17 12:00:44.893338435 -0800
@@ -0,0 +1,13 @@
+[Domain]
+Name=KDE
+Icon=kde
+
+[org.kde.powerdevil.backlighthelper.brightness]
+Name=Get brightness
+Description=System policies prevent you from getting the brightness level.
+Policy=yes
+
+[org.kde.powerdevil.backlighthelper.setbrightness]
+Name=Set brightness
+Description=System policies prevent you from setting the brightness level.
+Policy=yes
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/backlighthelper.cpp ../powerdevil/daemon/backends/upower/backlighthelper.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/backlighthelper.cpp	1969-12-31 16:00:00.000000000 -0800
+++ ../powerdevil/daemon/backends/upower/backlighthelper.cpp	2010-12-17 12:00:44.893338435 -0800
@@ -0,0 +1,142 @@
+/*  This file is part of the KDE project
+ *    Copyright (C) 2010 Lukas Tinkl <ltinkl@redhat.com>
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Library General Public
+ *    License version 2 as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Library General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Library General Public License
+ *    along with this library; see the file COPYING.LIB.  If not, write to
+ *    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+ *    Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "backlighthelper.h"
+
+#include <QtCore/QDir>
+#include <QtCore/QDebug>
+
+#define PREFIX "/sys/class/backlight/"
+
+BacklightHelper::BacklightHelper(QObject * parent)
+    : QObject(parent), m_isSupported(false)
+{
+    init();
+}
+
+void BacklightHelper::init()
+{
+    // find the first existing device with backlight support
+    QStringList interfaces;
+    interfaces << "nv_backlight" << "asus_laptop" << "toshiba"
+               << "eeepc" << "thinkpad_screen" << "acpi_video1"
+               << "mbp_backlight" << "acpi_video0"
+               << "fujitsu-laptop" << "sony" << "samsung";
+
+    QDir dir;
+    foreach (const QString & interface, interfaces) {
+        dir.setPath(PREFIX + interface);
+        //qDebug() << "searching dir:" << dir;
+        if (dir.exists()) {
+            m_dirname = dir.path();
+            qDebug() << "kernel backlight support found in" << m_dirname;
+            break;
+        }
+    }
+
+    if (m_dirname.isEmpty()) {
+        qWarning() << "no kernel backlight interface found";
+        return;
+    }
+
+    m_isSupported = true;
+}
+
+ActionReply BacklightHelper::brightness(const QVariantMap & args)
+{
+    Q_UNUSED(args);
+
+    ActionReply reply;
+
+    if (!m_isSupported) {
+        reply = ActionReply::HelperErrorReply;
+        return reply;
+    }
+
+    // current brightness
+    QFile file(m_dirname + "/brightness");
+    if (!file.open(QIODevice::ReadOnly)) {
+        reply = ActionReply::HelperErrorReply;
+        reply.setErrorCode(file.error());
+        qWarning() << "reading brightness failed with error code " << file.error() << file.errorString();
+        return reply;
+    }
+
+    QTextStream stream(&file);
+    int brightness;
+    stream >> brightness;
+    qDebug() << "brightness:" << brightness;
+    file.close();
+
+    reply.addData("brightness", brightness * 100 / maxBrightness());
+    qDebug() << "data contains:" << reply.data()["brightness"];
+
+    return reply;
+}
+
+ActionReply BacklightHelper::setbrightness(const QVariantMap & args)
+{
+    ActionReply reply;
+
+    if (!m_isSupported) {
+        reply = ActionReply::HelperErrorReply;
+        return reply;
+    }
+
+    QFile file(m_dirname + "/brightness");
+    if (!file.open(QIODevice::WriteOnly)) {
+        reply = ActionReply::HelperErrorReply;
+        reply.setErrorCode(file.error());
+        qWarning() << "writing brightness failed with error code " << file.error() << file.errorString();
+        return reply;
+    }
+
+    int actual_brightness = args["brightness"].toFloat() * maxBrightness() / 100;
+    qDebug() << "setting brightness:" << actual_brightness;
+    int result = file.write(QByteArray::number(actual_brightness));
+    file.close();
+
+    if (result == -1) {
+        reply = ActionReply::HelperErrorReply;
+        reply.setErrorCode(file.error());
+        qWarning() << "writing brightness failed with error code " << file.error() << file.errorString();
+    }
+
+    return reply;
+}
+
+int BacklightHelper::maxBrightness() const
+{
+    // maximum brightness
+    QFile file(m_dirname + "/max_brightness");
+    if (!file.open(QIODevice::ReadOnly)) {
+        qWarning() << "reading max brightness failed with error code " << file.error() << file.errorString();
+        return -1; // some non-zero value
+    }
+
+    QTextStream stream(&file);
+    int max_brightness;
+    stream >> max_brightness;
+    qDebug() << "max brightness:" << max_brightness;
+    file.close();
+
+    return max_brightness;
+}
+
+KDE4_AUTH_HELPER_MAIN("org.kde.powerdevil.backlighthelper", BacklightHelper)
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/backlighthelper.h ../powerdevil/daemon/backends/upower/backlighthelper.h
--- kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/backlighthelper.h	1969-12-31 16:00:00.000000000 -0800
+++ ../powerdevil/daemon/backends/upower/backlighthelper.h	2010-12-17 12:00:44.896671768 -0800
@@ -0,0 +1,45 @@
+/*  This file is part of the KDE project
+ *    Copyright (C) 2010 Lukas Tinkl <ltinkl@redhat.com>
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Library General Public
+ *    License version 2 as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Library General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Library General Public License
+ *    along with this library; see the file COPYING.LIB.  If not, write to
+ *    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+ *    Boston, MA 02110-1301, USA.
+ *
+ */
+
+#ifndef BACKLIGHTHELPER_H
+#define BACKLIGHTHELPER_H
+
+#include <QObject>
+#include <kauth.h>
+
+using namespace KAuth;
+
+class BacklightHelper: public QObject
+{
+    Q_OBJECT
+public:
+    BacklightHelper(QObject * parent = 0);
+
+public slots:
+    ActionReply brightness(const QVariantMap & args);
+    ActionReply setbrightness(const QVariantMap & args);
+
+private:
+    void init();
+    int maxBrightness() const;
+    bool m_isSupported;
+    QString m_dirname;
+};
+
+#endif // BACKLIGHTHELPER_H
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/powerdevilupowerbackend.cpp ../powerdevil/daemon/backends/upower/powerdevilupowerbackend.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/powerdevilupowerbackend.cpp	2010-11-25 09:40:32.000000000 -0800
+++ ../powerdevil/daemon/backends/upower/powerdevilupowerbackend.cpp	2010-12-17 12:00:44.893338435 -0800
@@ -27,34 +27,71 @@
 
 #include <KDebug>
 #include <KPluginFactory>
+#include <KAuth/Action>
 
 #include "xrandrbrightness.h"
 #include "upowersuspendjob.h"
 
+#define HELPER_ID "org.kde.powerdevil.backlighthelper"
+
 PowerDevilUPowerBackend::PowerDevilUPowerBackend(QObject* parent)
     : BackendInterface(parent),
-      m_brightNessControl(new XRandrBrightness()),
-      m_upowerInterface(new OrgFreedesktopUPowerInterface(UPOWER_SERVICE, "/org/freedesktop/UPower", QDBusConnection::systemBus(), parent)),
-      m_kbdBacklight(new OrgFreedesktopUPowerKbdBacklightInterface(UPOWER_SERVICE, "/org/freedesktop/UPower/KbdBacklight", QDBusConnection::systemBus(), parent)),
+      m_brightNessControl(0),
       m_lidIsPresent(false), m_lidIsClosed(false), m_onBattery(false)
 {
 }
 
 PowerDevilUPowerBackend::~PowerDevilUPowerBackend()
 {
-    qDeleteAll(m_devices);
-    delete m_upowerInterface;
     delete m_brightNessControl;
-    delete m_kbdBacklight;
 }
 
 bool PowerDevilUPowerBackend::isAvailable()
 {
-    return m_upowerInterface->isValid();
+    if (!QDBusConnection::systemBus().interface()->isServiceRegistered(UPOWER_SERVICE)) {
+        // Is it pending activation?
+        kDebug() << "UPower service, " << UPOWER_SERVICE << ", is not registered on the bus. Trying to find out if it is activated.";
+        QDBusMessage message = QDBusMessage::createMethodCall("org.freedesktop.DBus",
+                                                              "/org/freedesktop/DBus",
+                                                              "org.freedesktop.DBus",
+                                                              "ListActivatableNames");
+
+        QDBusPendingReply< QStringList > reply = QDBusConnection::systemBus().asyncCall(message);
+        reply.waitForFinished();
+
+        if (reply.isValid()) {
+            if (reply.value().contains(UPOWER_SERVICE)) {
+                kDebug() << "UPower was found, activating service...";
+                QDBusConnection::systemBus().interface()->startService(UPOWER_SERVICE);
+                return true;
+            } else {
+                kDebug() << "UPower cannot be found on this system.";
+                return false;
+            }
+        } else {
+            kWarning() << "Could not request activatable names to DBus!";
+            return false;
+        }
+    } else {
+        return true;
+    }
 }
 
 void PowerDevilUPowerBackend::init()
 {
+    // interfaces
+    if (!QDBusConnection::systemBus().interface()->isServiceRegistered(UPOWER_SERVICE)) {
+        // Activate it.
+        QDBusConnection::systemBus().interface()->startService(UPOWER_SERVICE);
+    }
+
+    m_upowerInterface = new OrgFreedesktopUPowerInterface(UPOWER_SERVICE, "/org/freedesktop/UPower", QDBusConnection::systemBus(), this);
+    m_kbdBacklight = new OrgFreedesktopUPowerKbdBacklightInterface(UPOWER_SERVICE, "/org/freedesktop/UPower/KbdBacklight", QDBusConnection::systemBus(), this);
+    m_brightNessControl = new XRandrBrightness();
+
+    // Capabilities
+    setCapabilities(SignalResumeFromSuspend);
+
     // devices
     enumerateDevices();
     connect(m_upowerInterface, SIGNAL(Changed()), this, SLOT(slotPropertyChanged()));
@@ -64,9 +101,7 @@
 
     // Brightness Controls available
     BrightnessControlsList controls;
-    if (m_brightNessControl->isSupported()) {
-        controls.insert(QLatin1String("LVDS1"), Screen);
-    }
+    controls.insert(QLatin1String("LVDS1"), Screen);
 
     if (m_kbdBacklight->isValid())
         controls.insert(QLatin1String("KBD"), Keyboard);
@@ -143,22 +178,52 @@
 
 float PowerDevilUPowerBackend::brightness(PowerDevil::BackendInterface::BrightnessControlType type) const
 {
+    float result = 0.0;
+
     if (type == Screen) {
-        kDebug() << "Screen brightness: " << m_brightNessControl->brightness();
-        return m_brightNessControl->brightness();
+        if (m_brightNessControl->isSupported()) {
+            //kDebug() << "Calling xrandr brightness";
+            result = m_brightNessControl->brightness();
+        } else {
+            //kDebug() << "Falling back to helper to get brightness";
+            KAuth::Action action("org.kde.powerdevil.backlighthelper.brightness");
+            action.setHelperID(HELPER_ID);
+            KAuth::ActionReply reply = action.execute();
+            if (reply.succeeded()) {
+                result = reply.data()["brightness"].toFloat();
+                //kDebug() << "org.kde.powerdevil.backlighthelper.brightness succeeded: " << reply.data()["brightness"];
+            }
+            else
+                kWarning() << "org.kde.powerdevil.backlighthelper.brightness failed";
+
+        }
+        kDebug() << "Screen brightness: " << result;
     } else if (type == Keyboard) {
-        kDebug() << "Kbd backlight: " << m_brightNessControl->brightness();
-        return m_kbdBacklight->GetBrightness() / m_kbdBacklight->GetMaxBrightness() * 100;
+        kDebug() << "Kbd backlight brightness: " << m_kbdBacklight->GetBrightness();
+        result = m_kbdBacklight->GetBrightness() / m_kbdBacklight->GetMaxBrightness() * 100;
     }
 
-    return 0.0;
+    return result;
 }
 
 bool PowerDevilUPowerBackend::setBrightness(float brightnessValue, PowerDevil::BackendInterface::BrightnessControlType type)
 {
     if (type == Screen) {
         kDebug() << "set screen brightness: " << brightnessValue;
-        m_brightNessControl->setBrightness(brightnessValue);
+        if (m_brightNessControl->isSupported()) {
+            m_brightNessControl->setBrightness(brightnessValue);
+        } else {
+            //kDebug() << "Falling back to helper to set brightness";
+            KAuth::Action action("org.kde.powerdevil.backlighthelper.setbrightness");
+            action.setHelperID(HELPER_ID);
+            action.addArgument("brightness", brightnessValue);
+            KAuth::ActionReply reply = action.execute();
+            if (reply.failed()) {
+                kWarning() << "org.kde.powerdevil.backlighthelper.setbrightness failed";
+                return false;
+            }
+        }
+
         float newBrightness = brightness(Screen);
         if (!qFuzzyCompare(newBrightness, m_cachedBrightness)) {
             m_cachedBrightness = newBrightness;
@@ -242,9 +307,9 @@
         bool lidIsClosed = m_upowerInterface->lidIsClosed();
         if (lidIsClosed != m_lidIsClosed) {
             if (lidIsClosed)
-                emit buttonPressed(LidClose);
+                setButtonPressed(LidClose);
             else
-                emit buttonPressed(LidOpen);
+                setButtonPressed(LidOpen);
         }
         m_lidIsClosed = lidIsClosed;
     }
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/powerdevilupowerbackend.desktop ../powerdevil/daemon/backends/upower/powerdevilupowerbackend.desktop
--- kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/powerdevilupowerbackend.desktop	2010-12-01 14:22:39.000000000 -0800
+++ ../powerdevil/daemon/backends/upower/powerdevilupowerbackend.desktop	2010-12-17 12:00:44.893338435 -0800
@@ -12,7 +12,9 @@
 Name[en_GB]=UPower PowerDevil Backend
 Name[es]=Motor UPower para PowerDevil
 Name[et]=UPoweri PowerDevili taustaprogramm
+Name[hu]=UPower Powerdevil-modul
 Name[ia]=UPower PowerDevil Backend (RetroParte de Powerdevil de UPower)
+Name[it]=Motore UPower di Powerdevil
 Name[ja]=UPower PowerDevil バックエンド
 Name[kk]=UPower PowerDevil тетігі
 Name[km]=កម្មវិធី​ខាងក្រោយ UPower PowerDevil
@@ -37,6 +39,7 @@
 Comment[es]=Usar el sistema de gestión de energía de KDE mediante el demonio UPower de freedesktop.org
 Comment[et]=KDE toitehalduse süsteemi kasutamine freedesktop.org-i upoweri deemoni abil
 Comment[ia]=Usar systema de Gestion de Energia de KDE usante demone upower de freedesktop.org
+Comment[it]=Usa il sistema di gestione energetica di KDE attraverso il demone upower di freedesktop.org
 Comment[kk]=freedesktop.org upower қызметі көмегімен KDE қуаттандыру жүйесін басқару
 Comment[km]=ប្រើ​ប្រព័ន្ធ​គ្រប់គ្រង​ថាមពល​របស់ KDE តាមរយៈ​ដេមិន freedesktop.org upower
 Comment[ko]=freedesktop.org UPower 데몬을 사용하는 KDE 전력 관리 시스템
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/powerdevilupowerbackend.h ../powerdevil/daemon/backends/upower/powerdevilupowerbackend.h
--- kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/powerdevilupowerbackend.h	2010-11-25 09:40:32.000000000 -0800
+++ ../powerdevil/daemon/backends/upower/powerdevilupowerbackend.h	2010-12-17 12:00:44.893338435 -0800
@@ -46,7 +46,7 @@
     virtual ~PowerDevilUPowerBackend();
 
     virtual void init();
-    virtual bool isAvailable();
+    static bool isAvailable();
 
     virtual float brightness(BrightnessControlType type = Screen) const;
 
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/xrandrbrightness.cpp ../powerdevil/daemon/backends/upower/xrandrbrightness.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/backends/upower/xrandrbrightness.cpp	2010-11-11 06:40:47.000000000 -0800
+++ ../powerdevil/daemon/backends/upower/xrandrbrightness.cpp	2010-12-17 12:00:44.893338435 -0800
@@ -67,7 +67,9 @@
 
 XRandrBrightness::~XRandrBrightness()
 {
-    XRRFreeScreenResources(m_resources);
+    if (m_resources) {
+        XRRFreeScreenResources(m_resources);
+    }
 }
 
 bool XRandrBrightness::isSupported() const
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/CMakeLists.txt ../powerdevil/daemon/CMakeLists.txt
--- kdebase-workspace-4.5.85/powerdevil//daemon/CMakeLists.txt	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/daemon/CMakeLists.txt	2010-12-17 12:00:44.930005101 -0800
@@ -18,54 +18,56 @@
     actions/bundled/handlebuttonevents.cpp
 )
 
-# Backends
-include(BackendConfig.cmake)
-
 # target no.1 - powerdevil core library
 set(powerdevilcore_SRCS
     powerdevilaction.cpp
     powerdevilactionpool.cpp
     powerdevilbackendinterface.cpp
-    powerdevilbackendloader.cpp
     powerdevilcore.cpp
-    powerdevilfdoconnector.cpp
     powerdevilpolicyagent.cpp
     powerdevilprofilegenerator.cpp
 )
 
 kde4_add_kcfg_files(powerdevilcore_SRCS ../PowerDevilSettings.kcfgc)
 
-qt4_add_dbus_adaptor(powerdevilcore_SRCS org.kde.Solid.PowerManagement.xml powerdevilcore.h PowerDevil::Core)
-qt4_add_dbus_adaptor(powerdevilcore_SRCS ${KDE4_DBUS_INTERFACES_DIR}/org.kde.Solid.PowerManagement.PolicyAgent.xml 
-                                         powerdevilpolicyagent.h PowerDevil::PolicyAgent
-                                         powermanagementpolicyagentadaptor PowerManagementPolicyAgentAdaptor)
-
 set(screensaver_xml "${KDEBASE_WORKSPACE_SOURCE_DIR}/krunner/dbus/org.freedesktop.ScreenSaver.xml")
 qt4_add_dbus_interface(powerdevilcore_SRCS ${screensaver_xml} screensaver_interface )
 
-qt4_add_dbus_adaptor(powerdevilcore_SRCS ${KDE4_DBUS_INTERFACES_DIR}/org.freedesktop.PowerManagement.xml powerdevilfdoconnector.h PowerDevil::FdoConnector powermanagementfdoadaptor PowerManagementFdoAdaptor)
-qt4_add_dbus_adaptor(powerdevilcore_SRCS ${KDE4_DBUS_INTERFACES_DIR}/org.freedesktop.PowerManagement.Inhibit.xml powerdevilfdoconnector.h PowerDevil::FdoConnector powermanagementinhibitadaptor PowerManagementInhibitAdaptor)
-
-kde4_add_library(powerdevilcore SHARED ${powerdevilcore_SRCS} ${powerdevil_bundled_actions_SRCS} ${POWERDEVIL_BACKEND_SRCS})
+kde4_add_library(powerdevilcore SHARED ${powerdevilcore_SRCS} ${powerdevil_bundled_actions_SRCS})
 set_target_properties(powerdevilcore PROPERTIES VERSION ${POWERDEVIL_CORE_VERSION_STRING} SOVERSION ${POWERDEVIL_CORE_VERSION_MAJOR})
 
 target_link_libraries(powerdevilcore
     ${KDE4_KDECORE_LIBS}
     ${KDE4_SOLID_LIBS}
     ${KDE4_KIDLETIME_LIBS}
-    ${POWERDEVIL_BACKEND_LIBS}
     kworkspace
 )
 
 # target no.2 - powerdevil kded module
 set(kded_powerdevil_SRCS
     kdedpowerdevil.cpp
+    powerdevilbackendloader.cpp
+    powerdevilfdoconnector.cpp
 )
 
-kde4_add_plugin(kded_powerdevil ${kded_powerdevil_SRCS})
+# DBus Adaptors
+qt4_add_dbus_adaptor(kded_powerdevil_SRCS org.kde.Solid.PowerManagement.xml powerdevilcore.h PowerDevil::Core)
+qt4_add_dbus_adaptor(kded_powerdevil_SRCS ${KDE4_DBUS_INTERFACES_DIR}/org.kde.Solid.PowerManagement.PolicyAgent.xml
+                                         powerdevilpolicyagent.h PowerDevil::PolicyAgent
+                                         powermanagementpolicyagentadaptor PowerManagementPolicyAgentAdaptor)
+
+qt4_add_dbus_adaptor(kded_powerdevil_SRCS ${KDE4_DBUS_INTERFACES_DIR}/org.freedesktop.PowerManagement.xml powerdevilfdoconnector.h PowerDevil::FdoConnector powermanagementfdoadaptor PowerManagementFdoAdaptor)
+qt4_add_dbus_adaptor(kded_powerdevil_SRCS ${KDE4_DBUS_INTERFACES_DIR}/org.freedesktop.PowerManagement.Inhibit.xml powerdevilfdoconnector.h PowerDevil::FdoConnector powermanagementinhibitadaptor PowerManagementInhibitAdaptor)
+
+
+# Backends
+include(BackendConfig.cmake)
+
+kde4_add_plugin(kded_powerdevil ${kded_powerdevil_SRCS} ${POWERDEVIL_BACKEND_SRCS})
 
 target_link_libraries(kded_powerdevil
     ${KDE4_KDECORE_LIBS}
+    ${POWERDEVIL_BACKEND_LIBS}
     powerdevilcore
 )
 
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/kdedpowerdevil.cpp ../powerdevil/daemon/kdedpowerdevil.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/kdedpowerdevil.cpp	2010-11-05 03:47:16.000000000 -0700
+++ ../powerdevil/daemon/kdedpowerdevil.cpp	2010-12-17 12:00:44.926671768 -0800
@@ -19,11 +19,20 @@
 
 #include "kdedpowerdevil.h"
 
+#include "powerdevilfdoconnector.h"
+#include "powermanagementadaptor.h"
+#include "powermanagementpolicyagentadaptor.h"
+
+#include "powerdevilbackendloader.h"
 #include "powerdevilcore.h"
 
 #include <QtCore/QTimer>
 
+#include <QtDBus/QDBusConnection>
+#include <QtDBus/QDBusConnectionInterface>
+
 #include <KAboutData>
+#include <KDebug>
 #include <KPluginFactory>
 
 K_PLUGIN_FACTORY( PowerDevilFactory,
@@ -56,7 +65,48 @@
     aboutData.addAuthor(ki18n( "Dario Freddi" ), ki18n("Maintainer"), "drf@kde.org",
                         "http://drfav.wordpress.com");
 
-    new PowerDevil::Core(this, KComponentData(aboutData));
+    if (QDBusConnection::systemBus().interface()->isServiceRegistered("org.freedesktop.PowerManagement") ||
+        QDBusConnection::systemBus().interface()->isServiceRegistered("com.novell.powersave") ||
+        QDBusConnection::systemBus().interface()->isServiceRegistered("org.freedesktop.Policy.Power")) {
+        kError() << "KDE Power Management system not initialized, another power manager has been detected";
+        return;
+    }
+
+    m_core = new PowerDevil::Core(this, KComponentData(aboutData));
+
+    connect(m_core, SIGNAL(coreReady()), this, SLOT(onCoreReady()));
+
+    // Before doing anything, let's set up our backend
+    PowerDevil::BackendInterface *interface = PowerDevil::BackendLoader::loadBackend(m_core);
+
+    if (!interface) {
+        // Ouch
+        kError() << "KDE Power Management System init failed!";
+        m_core->loadCore(0);
+    } else {
+        // Let's go!
+        kDebug() << "Backend loaded, loading core";
+        m_core->loadCore(interface);
+    }
+}
+
+void KDEDPowerDevil::onCoreReady()
+{
+    kDebug() << "Core is ready, registering various services on the bus...";
+    //DBus logic for the core
+    new PowerManagementAdaptor(m_core);
+    new PowerDevil::FdoConnector(m_core);
+
+    QDBusConnection::sessionBus().registerService("org.kde.Solid.PowerManagement");
+    QDBusConnection::sessionBus().registerObject("/org/kde/Solid/PowerManagement", m_core);
+
+    QDBusConnection::systemBus().interface()->registerService("org.freedesktop.Policy.Power");
+
+    // Start the Policy Agent service
+    new PowerManagementPolicyAgentAdaptor(PowerDevil::PolicyAgent::instance());
+
+    QDBusConnection::sessionBus().registerService("org.kde.Solid.PowerManagement.PolicyAgent");
+    QDBusConnection::sessionBus().registerObject("/org/kde/Solid/PowerManagement/PolicyAgent", PowerDevil::PolicyAgent::instance());
 }
 
 #include "kdedpowerdevil.moc"
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/kdedpowerdevil.h ../powerdevil/daemon/kdedpowerdevil.h
--- kdebase-workspace-4.5.85/powerdevil//daemon/kdedpowerdevil.h	2010-10-05 04:38:56.000000000 -0700
+++ ../powerdevil/daemon/kdedpowerdevil.h	2010-12-17 12:00:44.926671768 -0800
@@ -23,6 +23,10 @@
 #include <KDEDModule>
 #include <QVariantList>
 
+namespace PowerDevil {
+    class Core;
+}
+
 class KDEDPowerDevil : public KDEDModule
 {
     Q_OBJECT
@@ -34,6 +38,10 @@
 
 private Q_SLOTS:
     void init();
+    void onCoreReady();
+
+private:
+    PowerDevil::Core *m_core;
 };
 
 #endif // KDEDPOWERDEVIL_H
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/org.kde.Solid.PowerManagement.xml ../powerdevil/daemon/org.kde.Solid.PowerManagement.xml
--- kdebase-workspace-4.5.85/powerdevil//daemon/org.kde.Solid.PowerManagement.xml	2010-11-19 02:51:12.000000000 -0800
+++ ../powerdevil/daemon/org.kde.Solid.PowerManagement.xml	2010-12-17 12:00:44.926671768 -0800
@@ -1,16 +1,22 @@
 <!DOCTYPE node PUBLIC "-//freedesktop//DTD D-BUS Object Introspection 1.0//EN" "http://www.freedesktop.org/standards/dbus/1.0/introspect.dtd">
 <node>
   <interface name="org.kde.Solid.PowerManagement">
-    
     <method name="refreshStatus" />
     <method name="reloadCurrentProfile" />
     <method name="reparseConfiguration" />
+    <method name="backendCapabilities">
+      <arg type="u" direction="out" />
+    </method>
     <method name="loadProfile">
       <arg type="s" direction="in" />
     </method>
     <method name="currentProfile">
       <arg type="s" direction="out" />
     </method>
+    <method name="availableProfiles">
+      <arg type="a{ss}" direction="out" />
+      <annotation name="com.trolltech.QtDBus.QtTypeName.Out0" value="StringStringMap"/>
+    </method>
     <method name="setBrightness">
       <arg type="i" direction="in" />
     </method>
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilbackendinterface.cpp ../powerdevil/daemon/powerdevilbackendinterface.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilbackendinterface.cpp	2010-11-11 06:40:47.000000000 -0800
+++ ../powerdevil/daemon/powerdevilbackendinterface.cpp	2010-12-17 12:00:44.926671768 -0800
@@ -33,6 +33,7 @@
     BatteryState batteryState;
     QHash< BrightnessControlType, float > brightness;
     BrightnessControlsList brightnessControlsAvailable;
+    Capabilities capabilities;
     SuspendMethods suspendMethods;
     QString errorString;
     bool isReady;
@@ -50,6 +51,7 @@
 
 BackendInterface::~BackendInterface()
 {
+    delete d;
 }
 
 BackendInterface::AcAdapterState BackendInterface::acAdapterState() const
@@ -161,6 +163,16 @@
     emit resumeFromSuspend();
 }
 
+BackendInterface::Capabilities BackendInterface::capabilities() const
+{
+    return d->capabilities;
+}
+
+void BackendInterface::setCapabilities(BackendInterface::Capabilities capabilities)
+{
+    d->capabilities = capabilities;
+}
+
 }
 
 #include "powerdevilbackendinterface.moc"
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilbackendinterface.h ../powerdevil/daemon/powerdevilbackendinterface.h
--- kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilbackendinterface.h	2010-11-25 09:40:32.000000000 -0800
+++ ../powerdevil/daemon/powerdevilbackendinterface.h	2010-12-17 12:00:44.926671768 -0800
@@ -40,205 +40,261 @@
     virtual ~BackendInterface();
 
     /**
-        * This enum type defines the different states of the system battery.
-        *
-        * - NoBatteryState: No battery available
-        * - Normal: The battery is at its normal charge level
-        * - Warning: The battery is at its warning charge level
-        * - Low: The battery is at its low charge level
-        * - Critical: The battery is at its critical charge level
-        */
+     * This enum type defines the different states of the system battery.
+     *
+     * - NoBatteryState: No battery available
+     * - Normal: The battery is at its normal charge level
+     * - Warning: The battery is at its warning charge level
+     * - Low: The battery is at its low charge level
+     * - Critical: The battery is at its critical charge level
+     */
     enum BatteryState{ NoBatteryState, Normal, Warning, Low, Critical };
 
     /**
-        * This enum type defines the different states of the AC adapter.
-        *
-        * - UnknownAcAdapterState: The AC adapter has an unknown state
-        * - Plugged: The AC adapter is plugged
-        * - Unplugged: The AC adapter is unplugged
-        */
+     * This enum type defines the different states of the AC adapter.
+     *
+     * - UnknownAcAdapterState: The AC adapter has an unknown state
+     * - Plugged: The AC adapter is plugged
+     * - Unplugged: The AC adapter is unplugged
+     */
     enum AcAdapterState{ UnknownAcAdapterState, Plugged, Unplugged };
 
     /**
-        * This enum type defines the types of system button events.
-        *
-        * - UnknownButtonType: An unknown button
-        * - PowerButton: A power button pressed event, generally used to turn on or off the system
-        * - SleepButton: A sleep button pressed event, generally used to make the system asleep
-        * - LidOpen: A laptop lid open event
-        * - LidClose: A laptop lid close event
-        */
+     * This enum type defines the types of system button events.
+     *
+     * - UnknownButtonType: An unknown button
+     * - PowerButton: A power button pressed event, generally used to turn on or off the system
+     * - SleepButton: A sleep button pressed event, generally used to make the system asleep
+     * - LidOpen: A laptop lid open event
+     * - LidClose: A laptop lid close event
+     */
     enum ButtonType{ UnknownButtonType, PowerButton, SleepButton, LidOpen, LidClose };
 
     /**
-        * This enum type defines the different suspend methods.
-        *
-        * - UnknownSuspendMethod: The name says it all
-        * - Standby: Processes are stopped, some hardware is deactivated (ACPI S1)
-        * - ToRam: Most devices are deactivated, only RAM is powered (ACPI S3)
-        * - ToDisk: State of the machine is saved to disk, and it's powered down (ACPI S4)
-        */
+     * This enum type defines the different suspend methods.
+     *
+     * - UnknownSuspendMethod: The name says it all
+     * - Standby: Processes are stopped, some hardware is deactivated (ACPI S1)
+     * - ToRam: Most devices are deactivated, only RAM is powered (ACPI S3)
+     * - ToDisk: State of the machine is saved to disk, and it's powered down (ACPI S4)
+     */
     enum SuspendMethod{ UnknownSuspendMethod = 0, Standby = 1, ToRam = 2, ToDisk = 4, HybridSuspend = 8 };
 
     /**
-        * This type stores an OR combination of SuspendMethod values.
-        */
+     * This type stores an OR combination of SuspendMethod values.
+     */
     Q_DECLARE_FLAGS(SuspendMethods, SuspendMethod)
 
     /**
-        * This enum defines the different types of brightness controls.
-        *
-        * - UnknownBrightnessControl: Unknown
-        * - Screen: Brightness control for a monitor or laptop panel
-        * - Keyboard: Brightness control for a keyboard backlight
-        */
+     * This enum defines the different types of brightness controls.
+     *
+     * - UnknownBrightnessControl: Unknown
+     * - Screen: Brightness control for a monitor or laptop panel
+     * - Keyboard: Brightness control for a keyboard backlight
+     */
     enum BrightnessControlType{ UnknownBrightnessControl = 0, Screen = 1, Keyboard = 2 };
 
     typedef QHash<QString, BrightnessControlType> BrightnessControlsList;
 
     /**
-        * This enum defines the different types brightness keys.
-        *
-        * - Increase: Key to increase brightness (Qt::Key_MonBrightnessUp)
-        * - Decrease: Key to decrease brightness (Qt::Key_MonBrightnessDown)
-        */
+     * This enum defines the different types brightness keys.
+     *
+     * - Increase: Key to increase brightness (Qt::Key_MonBrightnessUp)
+     * - Decrease: Key to decrease brightness (Qt::Key_MonBrightnessDown)
+     */
     enum BrightnessKeyType{ Increase, Decrease };
 
+    /**
+     * This enum defines capabilities of the backend
+     *
+     * - SignalResumeFromSuspend: The backend is able to stream the @c resumeFromSuspend signal accurately
+     */
+    enum Capability { NoCapabilities = 0, SignalResumeFromSuspend = 1 };
+
+    Q_DECLARE_FLAGS(Capabilities, Capability)
+
+    /**
+     * This struct contains information for a recall notice from the vendor
+     */
     struct RecallNotice {
+        /** The battery uuid */
         QString batteryId;
+        /** The vendor's name */
         QString vendor;
+        /** The vendor's website */
         QString url;
     };
 
+    /**
+     * Initializes the backend. This function @b MUST be called before the backend is usable. Using
+     * any method in BackendInterface without initializing it might lead to undefined behavior. The signal
+     * @c backendReady or @c backendError will be streamed upon completion.
+     *
+     * @note Backend implementations @b MUST reimplement this function
+     */
     virtual void init() = 0;
 
-    virtual bool isAvailable() = 0;
+    /**
+     * @returns the capabilities of the backend
+     * @see PowerDevil::BackendInterface::Capability
+     */
+    Capabilities capabilities() const;
 
     /**
-        * Retrieves the current state of the system battery.
-        *
-        * @return the current battery state
-        * @see Solid::Control::PowerManager::BatteryState
-        */
+     * Retrieves the current state of the system battery.
+     *
+     * @return the current battery state
+     * @see PowerDevil::BackendInterface::BatteryState
+     */
     BatteryState batteryState() const;
 
     /**
-        * Retrieves the current estimated remaining time of the system batteries
-        *
-        * @return the current global estimated remaining time in milliseconds
-        */
+     * Retrieves the current estimated remaining time of the system batteries
+     *
+     * @return the current global estimated remaining time in milliseconds
+     */
     qulonglong batteryRemainingTime() const;
 
     /**
-        * Retrieves the current state of the system AC adapter.
-        *
-        * @return the current AC adapter state
-        * @see Solid::Control::PowerManager::AcAdapterState
-        */
+     * Retrieves the current state of the system AC adapter.
+     *
+     * @return the current AC adapter state
+     * @see PowerDevil::BackendInterface::AcAdapterState
+     */
     AcAdapterState acAdapterState() const;
 
 
     /**
-        * Retrieves the set of suspend methods supported by the system.
-        *
-        * @return the suspend methods supported by this system
-        * @see Solid::Control::PowerManager::SuspendMethod
-        * @see Solid::Control::PowerManager::SuspendMethods
-        */
+     * Retrieves the set of suspend methods supported by the system.
+     *
+     * @return the suspend methods supported by this system
+     * @see PowerDevil::BackendInterface::SuspendMethod
+     * @see PowerDevil::BackendInterface::SuspendMethods
+     */
     SuspendMethods supportedSuspendMethods() const;
 
     /**
-        * Requests a suspend of the system.
-        *
-        * @param method the suspend method to use
-        * @return the job handling the operation
-        */
+     * Requests a suspend of the system.
+     *
+     * @param method the suspend method to use
+     * @return the job handling the operation
+     */
     virtual KJob *suspend(SuspendMethod method) = 0;
 
     /**
-        * Checks if brightness controls are enabled on this system.
-        *
-        * @return a list of the devices available to control
-        */
+     * Checks if brightness controls are enabled on this system.
+     *
+     * @return a list of the devices available to control
+     */
     BrightnessControlsList brightnessControlsAvailable() const;
 
     /**
-        * Gets the screen brightness.
-        *
-        * @param device the name of the device that you would like to control
-        * @return the brightness of the device, as a percentage
-        */
+     * Gets the screen brightness.
+     *
+     * @param device the name of the device that you would like to control
+     * @return the brightness of the device, as a percentage
+     */
     virtual float brightness(BrightnessControlType type = Screen) const;
 
+    /**
+     * @returns whether the lid is closed or not.
+     */
     bool isLidClosed() const;
 
     /**
-        * Sets the screen brightness.
-        *
-        * @param brightness the desired screen brightness, as a percentage
-        * @param device the name of the device that you would like to control
-        * @return true if the brightness change succeeded, false otherwise
-        */
+     * Sets the screen brightness.
+     *
+     * @param brightness the desired screen brightness, as a percentage
+     * @param device the name of the device that you would like to control
+     * @return true if the brightness change succeeded, false otherwise
+     */
     virtual bool setBrightness(float brightness, BrightnessControlType type = Screen) = 0;
 
     /**
-        * Should be called when the user presses a brightness key.
-        *
-        * @param type the type of the brightness key press
-        * @see Solid::Control::PowerManager::BrightnessKeyType
-        */
+     * Should be called when the user presses a brightness key.
+     *
+     * @param type the type of the brightness key press
+     * @see PowerDevil::BackendInterface::BrightnessKeyType
+     */
     virtual void brightnessKeyPressed(BrightnessKeyType type) = 0;
 
+    /**
+     * Retrieves the capacities of the installed batteries in percentage.
+     *
+     * @returns A dictionary with the battery's capacity percentage mapped to the battery uuid.
+     */
     QHash< QString, uint > capacities() const;
 
+    /**
+     * Returns a list of recall notices, if available
+     *
+     * @return a list of recall notices
+     * @see PowerDevil::BackendInterface::RecallNotice
+     */
     QList< RecallNotice > recallNotices() const;
 
 Q_SIGNALS:
     /**
-        * This signal is emitted when the AC adapter is plugged or unplugged.
-        *
-        * @param newState the new state of the AC adapter, it's one of the
-        * type @see Solid::Control::PowerManager::AcAdapterState
-        */
+     * This signal is emitted when the AC adapter is plugged or unplugged.
+     *
+     * @param newState the new state of the AC adapter, it's one of the
+     * type @see PowerDevil::BackendInterface::AcAdapterState
+     */
     void acAdapterStateChanged(PowerDevil::BackendInterface::AcAdapterState newState);
 
     /**
-        * This signal is emitted when the system battery state changed.
-        *
-        * @param newState the new state of the system battery, it's one of the
-        * type @see Solid::Control::PowerManager::BatteryState
-        */
+     * This signal is emitted when the system battery state changed.
+     *
+     * @param newState the new state of the system battery, it's one of the
+     * type @see PowerDevil::BackendInterface::BatteryState
+     */
     void batteryStateChanged(PowerDevil::BackendInterface::BatteryState newState);
 
     /**
-        * This signal is emitted when a button has been pressed.
-        *
-        * @param buttonType the pressed button type, it's one of the
-        * type @see Solid::Control::PowerManager::ButtonType
-        */
+     * This signal is emitted when a button has been pressed.
+     *
+     * @param buttonType the pressed button type, it's one of the
+     * type @see PowerDevil::BackendInterface::ButtonType
+     */
     void buttonPressed(PowerDevil::BackendInterface::ButtonType buttonType);
 
     /**
-    * This signal is emitted when the brightness changes.
-    *
-    * @param brightness the new brightness level
-    */
+     * This signal is emitted when the brightness changes.
+     *
+     * @param brightness the new brightness level
+     */
     void brightnessChanged(float brightness, PowerDevil::BackendInterface::BrightnessControlType type);
 
     /**
-    * This signal is emitted when the estimated battery remaining time changes.
-    *
-    * @param time the new remaining time
-    */
+     * This signal is emitted when the estimated battery remaining time changes.
+     *
+     * @param time the new remaining time
+     */
     void batteryRemainingTimeChanged(qulonglong time);
 
+    /**
+     * This signal is emitted when the backend is ready to be used
+     *
+     * @see init
+     */
     void backendReady();
 
+    /**
+     * This signal is emitted if the backend could not be initialized
+     *
+     * @param error Details about the error occurred
+     * @see init
+     */
     void backendError(const QString &error);
 
+    /**
+     * This signal is emitted when the PC is resuming from suspension
+     */
     void resumeFromSuspend();
 
 protected:
+    void setCapabilities(Capabilities capabilities);
+
     void onBrightnessChanged(BrightnessControlType device, float brightness);
     void setBatteryRemainingTime(qulonglong time);
     void setButtonPressed(PowerDevil::BackendInterface::ButtonType type);
@@ -264,4 +320,7 @@
 
 }
 
+Q_DECLARE_OPERATORS_FOR_FLAGS(PowerDevil::BackendInterface::Capabilities)
+Q_DECLARE_OPERATORS_FOR_FLAGS(PowerDevil::BackendInterface::SuspendMethods)
+
 #endif // POWERDEVIL_BACKENDINTERFACE_H
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilbackendloader.cpp ../powerdevil/daemon/powerdevilbackendloader.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilbackendloader.cpp	2010-11-25 09:40:32.000000000 -0800
+++ ../powerdevil/daemon/powerdevilbackendloader.cpp	2010-12-17 12:00:44.930005101 -0800
@@ -23,27 +23,31 @@
 #include "backends/upower/powerdevilupowerbackend.h"
 #include "backends/hal/powerdevilhalbackend.h"
 
+#include <KDebug>
+
 namespace PowerDevil {
 namespace BackendLoader {
 
 BackendInterface* loadBackend(QObject *parent)
 {
-    BackendInterface *interface;
     // Check UPower first
-    interface = new PowerDevilUPowerBackend(parent);
-    if (interface->isAvailable()) {
-        return interface;
+    kDebug() << "Loading UPower backend...";
+    if (PowerDevilUPowerBackend::isAvailable()) {
+        kDebug() << "Success!";
+        return new PowerDevilUPowerBackend(parent);
     }
 
+    kDebug() << "Failed!";
+
     // If we are here, try HAL
-    interface->deleteLater();
-    interface = new PowerDevilHALBackend(parent);
-    if (interface->isAvailable()) {
-        return interface;
+    kDebug() << "Loading HAL backend...";
+    if (PowerDevilHALBackend::isAvailable()) {
+        kDebug() << "Success!";
+        return new PowerDevilHALBackend(parent);
     }
 
     // Fail...
-    interface->deleteLater();
+    kDebug() << "Failed!";
     return 0;
 }
 
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilbackendloader.h ../powerdevil/daemon/powerdevilbackendloader.h
--- kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilbackendloader.h	2010-11-25 09:40:32.000000000 -0800
+++ ../powerdevil/daemon/powerdevilbackendloader.h	2010-12-17 12:00:44.930005101 -0800
@@ -29,7 +29,7 @@
 namespace BackendLoader
 {
     BackendInterface *loadBackend(QObject *parent);
-};
+}
 
 }
 
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilcore.cpp ../powerdevil/daemon/powerdevilcore.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilcore.cpp	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/daemon/powerdevilcore.cpp	2010-12-17 12:00:44.930005101 -0800
@@ -20,14 +20,11 @@
 #include "powerdevilcore.h"
 
 #include "PowerDevilSettings.h"
-#include "powermanagementadaptor.h"
 #include "screensaver_interface.h"
 
 #include "powerdevilaction.h"
 #include "powerdevilactionpool.h"
 #include "powerdevilbackendinterface.h"
-#include "powerdevilbackendloader.h"
-#include "powerdevilfdoconnector.h"
 #include "powerdevilpolicyagent.h"
 #include "powerdevilprofilegenerator.h"
 
@@ -58,20 +55,6 @@
     , m_applicationData(componentData)
     , m_criticalBatteryTimer(new QTimer(this))
 {
-    // Before doing anything, let's set up our backend
-    m_backend = PowerDevil::BackendLoader::loadBackend(this);
-
-    if (!m_backend) {
-        // Ouch
-        kError() << "KDE Power Management System init failed!";
-        onBackendError(i18n("No valid Power Management backend plugins are available. "
-                            "A new installation might solve this problem."));
-    } else {
-        // Async backend init - so that KDED gets a bit of a speed up
-        connect(m_backend, SIGNAL(backendReady()), this, SLOT(onBackendReady()));
-        connect(m_backend, SIGNAL(backendError(QString)), this, SLOT(onBackendError(QString)));
-        m_backend->init();
-    }
 }
 
 Core::~Core()
@@ -80,23 +63,41 @@
     ActionPool::instance()->unloadAllActiveActions();
 }
 
-void Core::onBackendReady()
+void Core::loadCore(BackendInterface* backend)
 {
-    kDebug() << "Backend is ready, KDE Power Management system initialized";
-
-    if (QDBusConnection::systemBus().interface()->isServiceRegistered("org.freedesktop.PowerManagement") ||
-        QDBusConnection::systemBus().interface()->isServiceRegistered("com.novell.powersave") ||
-        QDBusConnection::systemBus().interface()->isServiceRegistered("org.freedesktop.Policy.Power")) {
-        kError() << "KDE Power Management system not initialized, another power manager has been detected";
+    if (!backend) {
+        onBackendError(i18n("No valid Power Management backend plugins are available. "
+                            "A new installation might solve this problem."));
         return;
     }
 
+    m_backend = backend;
+
+    // Async backend init - so that KDED gets a bit of a speed up
+    kDebug() << "Core loaded, initializing backend";
+    connect(m_backend, SIGNAL(backendReady()), this, SLOT(onBackendReady()));
+    connect(m_backend, SIGNAL(backendError(QString)), this, SLOT(onBackendError(QString)));
+    m_backend->init();
+
+    // Register DBus Metatypes
+    qDBusRegisterMetaType< StringStringMap >();
+}
+
+void Core::onBackendReady()
+{
+    kDebug() << "Backend is ready, KDE Power Management system initialized";
+
     m_profilesConfig = KSharedConfig::openConfig("powerdevil2profilesrc", KConfig::SimpleConfig);
 
     // Is it brand new?
     if (m_profilesConfig->groupList().isEmpty()) {
         // Generate defaults
-        ProfileGenerator::generateProfiles();
+        if (ProfileGenerator::generateProfiles(true) == ProfileGenerator::ResultUpgraded) {
+            // Notify the user
+            emitNotification("warningnot", i18n("Your Power Profiles have been updated to be used with the new KDE Power "
+                                                "Management System. You can tweak them or generate a new set of defaults from "
+                                                "System Settings."), "system-software-update");
+        }
         m_profilesConfig->reparseConfiguration();
     }
 
@@ -130,15 +131,6 @@
     // Set up the policy agent
     PowerDevil::PolicyAgent::instance()->init();
 
-    //DBus
-    new PowerManagementAdaptor(this);
-    new FdoConnector(this);
-
-    QDBusConnection::sessionBus().registerService("org.kde.Solid.PowerManagement");
-    QDBusConnection::sessionBus().registerObject("/org/kde/Solid/PowerManagement", this);
-
-    QDBusConnection::systemBus().interface()->registerService("org.freedesktop.Policy.Power");
-
     // Set up the critical battery timer
     m_criticalBatteryTimer->setSingleShot(true);
     m_criticalBatteryTimer->setInterval(30000);
@@ -148,6 +140,7 @@
     QTimer::singleShot(30000, this, SLOT(checkBatteryStatus()));
 
     // All systems up Houston, let's go!
+    emit coreReady();
     refreshStatus();
 
     KActionCollection* actionCollection = new KActionCollection( this );
@@ -250,6 +243,29 @@
     emit configurationReloaded();
 }
 
+StringStringMap Core::availableProfiles() const
+{
+    QMap< QString, QString > retmap;
+    foreach (const QString &ent, m_profilesConfig->groupList()) {
+        if (ent == "Performance") {
+            retmap.insert(ent, i18nc("Name of a power profile", "Performance"));
+        } else if (ent == "Powersave") {
+            retmap.insert(ent, i18nc("Name of a power profile", "Powersave"));
+        } else if (ent == "Aggressive powersave") {
+            retmap.insert(ent, i18nc("Name of a power profile", "Aggressive powersave"));
+        } else {
+            KConfigGroup group(m_profilesConfig, ent);
+            if (group.hasKey("name")) {
+                retmap.insert(ent, group.readEntry("name"));
+            } else {
+                retmap.insert(ent, ent);
+            }
+        }
+    }
+
+    return retmap;
+}
+
 void Core::reloadProfile(int state)
 {
     if (m_loadedBatteriesUdi.isEmpty()) {
@@ -278,7 +294,7 @@
     }
 }
 
-void Core::loadProfile(const QString& name)
+void Core::loadProfile(const QString& id)
 {
     // Policy check
     if (PolicyAgent::instance()->requirePolicyCheck(PolicyAgent::ChangeProfile) != PolicyAgent::None) {
@@ -290,12 +306,12 @@
     ActionPool::instance()->unloadAllActiveActions();
 
     // Now, let's retrieve our profile
-    KConfigGroup config(m_profilesConfig, name);
+    KConfigGroup config(m_profilesConfig, id);
 
     if (!config.isValid() || config.groupList().isEmpty()) {
         emitNotification("powerdevilerror", i18n("The profile \"%1\" has been selected, "
                          "but it does not exist.\nPlease check your PowerDevil configuration.",
-                         name), "dialog-error");
+                         id), "dialog-error");
         return;
     }
 
@@ -309,13 +325,13 @@
             emitNotification("powerdevilerror", i18n("The profile \"%1\" tried to activate %2, "
                              "a non existent action. This is usually due to an installation problem"
                              " or to a configuration problem.",
-                             name, actionName), "dialog-warning");          
-        }        
+                             id, actionName), "dialog-warning");
+        }
     }
 
     // Set the current profile. Notify if different.
-    if (m_currentProfile != name) {
-        m_currentProfile = name;
+    if (m_currentProfile != id) {
+        m_currentProfile = id;
         emit profileChanged(m_currentProfile);
     }
 
@@ -369,16 +385,6 @@
     Device device(udi);
     Battery *b = qobject_cast<Battery*>(device.asDeviceInterface(DeviceInterface::Battery));
 
-    if (!b) {
-        // Not interesting to us
-        return;
-    }
-
-    if (b->type() != Solid::Battery::PrimaryBattery && b->type() != Solid::Battery::UpsBattery) {
-        // Not interesting to us
-        return;
-    }
-
     disconnect(b, SIGNAL(chargePercentChanged(int,QString)),
                this, SLOT(onBatteryChargePercentChanged(int,QString)));
 
@@ -562,7 +568,7 @@
     QList< int > timeoutsToClean = m_registeredActionTimeouts[action];
     m_registeredActionTimeouts.remove(action);
     for (QHash< Action*, QList< int > >::const_iterator i = m_registeredActionTimeouts.constBegin();
-         i != m_registeredActionTimeouts.constEnd(); ++i) {
+        i != m_registeredActionTimeouts.constEnd(); ++i) {
         foreach (int timeoutId, i.value()) {
             if (timeoutsToClean.contains(timeoutId)) {
                 timeoutsToClean.removeOne(timeoutId);
@@ -632,6 +638,11 @@
     return m_currentProfile;
 }
 
+uint Core::backendCapabilities()
+{
+    return m_backend->capabilities();
+}
+
 void Core::setBrightness(int percent)
 {
     QVariantMap args;
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilcore.h ../powerdevil/daemon/powerdevilcore.h
--- kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilcore.h	2010-11-19 02:51:12.000000000 -0800
+++ ../powerdevil/daemon/powerdevilcore.h	2010-12-17 12:00:44.926671768 -0800
@@ -28,6 +28,8 @@
 
 #include <KComponentData>
 
+typedef QMap< QString, QString > StringStringMap;
+
 class KDirWatch;
 class QTimer;
 class KNotification;
@@ -57,16 +59,20 @@
                           const QString &iconname = "dialog-ok-apply");
 
     BackendInterface *backend();
-    
+
     // More...
 
 public Q_SLOTS:
+    void loadCore(PowerDevil::BackendInterface *backend);
     // Set of common action - useful for the DBus interface
+    uint backendCapabilities();
     void refreshStatus();
     void reloadProfile();
     void reloadCurrentProfile();
     void reparseConfiguration();
 
+    StringStringMap availableProfiles() const;
+
     void loadProfile(const QString &name);
     QString currentProfile() const;
 
@@ -85,6 +91,7 @@
     void onResumeFromSuspend();
 
 Q_SIGNALS:
+    void coreReady();
     void profileChanged(const QString &newProfile);
     void configurationReloaded();
     void brightnessChanged(int percent);
@@ -134,4 +141,6 @@
 
 }
 
+Q_DECLARE_METATYPE(StringStringMap)
+
 #endif // POWERDEVILCORE_H
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilfdoconnector.cpp ../powerdevil/daemon/powerdevilfdoconnector.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilfdoconnector.cpp	2010-11-11 06:40:47.000000000 -0800
+++ ../powerdevil/daemon/powerdevilfdoconnector.cpp	2010-12-17 12:00:44.930005101 -0800
@@ -101,7 +101,7 @@
 
 void FdoConnector::onAcAdapterStateChanged(PowerDevil::BackendInterface::AcAdapterState newstate)
 {
-    emit PowerSaveStatusChanged(newstate == PowerDevil::BackendInterface::Plugged);
+    emit PowerSaveStatusChanged(newstate == PowerDevil::BackendInterface::Unplugged);
 }
 
 void FdoConnector::onUnavailablePoliciesChanged(PowerDevil::PolicyAgent::RequiredPolicies newpolicies)
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilpolicyagent.cpp ../powerdevil/daemon/powerdevilpolicyagent.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilpolicyagent.cpp	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/daemon/powerdevilpolicyagent.cpp	2010-12-17 12:00:44.930005101 -0800
@@ -29,8 +29,6 @@
 #include <KGlobal>
 #include <KDebug>
 
-#include "powermanagementpolicyagentadaptor.h"
-
 namespace PowerDevil
 {
 
@@ -72,12 +70,6 @@
 
 void PolicyAgent::init()
 {
-    // Start the DBus service
-    new PowerManagementPolicyAgentAdaptor(this);
-
-    QDBusConnection::sessionBus().registerService("org.kde.Solid.PowerManagement.PolicyAgent");
-    QDBusConnection::sessionBus().registerObject("/org/kde/Solid/PowerManagement/PolicyAgent", this);
-
     // Let's cache the needed information to check if our session is actually active
     if (!QDBusConnection::systemBus().interface()->isServiceRegistered("org.freedesktop.ConsoleKit")) {
         // No way to determine if we are on the current session, simply suppose we are
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilpolicyagent.h ../powerdevil/daemon/powerdevilpolicyagent.h
--- kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilpolicyagent.h	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/daemon/powerdevilpolicyagent.h	2010-12-17 12:00:44.930005101 -0800
@@ -27,13 +27,15 @@
 
 #include <QtDBus/QDBusContext>
 
+#include <kdemacros.h>
+
 class QDBusServiceWatcher;
 class QDBusInterface;
 
 namespace PowerDevil
 {
 
-class PolicyAgent : public QObject, protected QDBusContext
+class KDE_EXPORT PolicyAgent : public QObject, protected QDBusContext
 {
     Q_OBJECT
     Q_DISABLE_COPY(PolicyAgent)
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilprofilegenerator.cpp ../powerdevil/daemon/powerdevilprofilegenerator.cpp
--- kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilprofilegenerator.cpp	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/daemon/powerdevilprofilegenerator.cpp	2010-12-17 12:00:44.926671768 -0800
@@ -36,8 +36,16 @@
 
 namespace PowerDevil {
 
-void ProfileGenerator::generateProfiles()
+ProfileGenerator::GeneratorResult ProfileGenerator::generateProfiles(bool tryUpgrade)
 {
+    if (tryUpgrade) {
+        KSharedConfigPtr oldProfilesConfig = KSharedConfig::openConfig("powerdevilprofilesrc", KConfig::SimpleConfig);
+        if (!oldProfilesConfig->groupList().isEmpty()) {
+            // We can upgrade, let's do that.
+            upgradeProfiles();
+            return ResultUpgraded;
+        }
+    }
     QSet< Solid::PowerManagement::SleepState > methods = Solid::PowerManagement::supportedSleepStates();
 
     // Let's change some defaults
@@ -58,7 +66,7 @@
     }
 
     // Let's start: performance profile before anything else
-    KConfigGroup performance(profilesConfig, i18nc("Name of a power profile", "Performance"));
+    KConfigGroup performance(profilesConfig, "Performance");
     performance.writeEntry("icon", "preferences-system-performance");
 
     // We want to dim the screen after a while, definitely
@@ -108,7 +116,7 @@
         }
 
         // Powersave
-        KConfigGroup powersave(profilesConfig, i18nc("Name of a power profile", "Powersave"));
+        KConfigGroup powersave(profilesConfig, "Powersave");
         powersave.writeEntry("icon", "preferences-system-power-management");
         // Less brightness.
         {
@@ -150,7 +158,7 @@
 
 
         // Ok, now for aggressive powersave
-        KConfigGroup aggrPowersave(profilesConfig, i18nc("Name of a power profile", "Aggressive powersave"));
+        KConfigGroup aggrPowersave(profilesConfig, "Aggressive powersave");
         aggrPowersave.writeEntry("icon", "battery-low");
         // Less brightness.
         {
@@ -199,6 +207,8 @@
     // Save and be happy
     PowerDevilSettings::self()->writeConfig();
     profilesConfig->sync();
+
+    return ResultGenerated;
 }
 
 void ProfileGenerator::upgradeProfiles()
diff -Naur kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilprofilegenerator.h ../powerdevil/daemon/powerdevilprofilegenerator.h
--- kdebase-workspace-4.5.85/powerdevil//daemon/powerdevilprofilegenerator.h	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/daemon/powerdevilprofilegenerator.h	2010-12-17 12:00:44.926671768 -0800
@@ -25,7 +25,13 @@
 
 namespace ProfileGenerator
 {
-    void generateProfiles();
+    enum GeneratorResult {
+        ResultFailed = 0,
+        ResultGenerated = 1,
+        ResultUpgraded = 2
+    };
+
+    GeneratorResult generateProfiles(bool tryUpgrade = false);
     void upgradeProfiles();
 }
 
diff -Naur kdebase-workspace-4.5.85/powerdevil//kcmodule/global/GeneralPage.cpp ../powerdevil/kcmodule/global/GeneralPage.cpp
--- kdebase-workspace-4.5.85/powerdevil//kcmodule/global/GeneralPage.cpp	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/kcmodule/global/GeneralPage.cpp	2010-12-17 12:00:44.940005101 -0800
@@ -29,6 +29,7 @@
 #include <QtDBus/QDBusMessage>
 #include <QtDBus/QDBusReply>
 #include <QtDBus/QDBusConnection>
+#include <QtDBus/QDBusMetaType>
 
 #include <KNotifyConfigWidget>
 #include <KPluginFactory>
@@ -39,9 +40,14 @@
                 )
 K_EXPORT_PLUGIN(PowerDevilGeneralKCMFactory("powerdevilglobalconfig","powerdevil"))
 
+typedef QMap< QString, QString > StringStringMap;
+Q_DECLARE_METATYPE(StringStringMap)
+
 GeneralPage::GeneralPage(QWidget *parent, const QVariantList &args)
         : KCModule(PowerDevilGeneralKCMFactory::componentData(), parent, args)
 {
+    qDBusRegisterMetaType< StringStringMap >();
+
     setButtons(Apply | Help);
 
     KAboutData *about =
@@ -139,10 +145,10 @@
 
     BatteryCriticalCombo->setCurrentIndex(BatteryCriticalCombo->findData(PowerDevilSettings::batteryCriticalAction()));
 
-    acProfile->setCurrentIndex(acProfile->findText(PowerDevilSettings::aCProfile()));
-    lowProfile->setCurrentIndex(acProfile->findText(PowerDevilSettings::lowProfile()));
-    warningProfile->setCurrentIndex(acProfile->findText(PowerDevilSettings::warningProfile()));
-    batteryProfile->setCurrentIndex(acProfile->findText(PowerDevilSettings::batteryProfile()));
+    acProfile->setCurrentIndex(acProfile->findData(PowerDevilSettings::aCProfile()));
+    lowProfile->setCurrentIndex(lowProfile->findData(PowerDevilSettings::lowProfile()));
+    warningProfile->setCurrentIndex(warningProfile->findData(PowerDevilSettings::warningProfile()));
+    batteryProfile->setCurrentIndex(batteryProfile->findData(PowerDevilSettings::batteryProfile()));
 }
 
 void GeneralPage::configureNotifications()
@@ -160,10 +166,10 @@
 
     PowerDevilSettings::setBatteryCriticalAction(BatteryCriticalCombo->itemData(BatteryCriticalCombo->currentIndex()).toInt());
 
-    PowerDevilSettings::setACProfile(acProfile->currentText());
-    PowerDevilSettings::setLowProfile(lowProfile->currentText());
-    PowerDevilSettings::setWarningProfile(warningProfile->currentText());
-    PowerDevilSettings::setBatteryProfile(batteryProfile->currentText());
+    PowerDevilSettings::setACProfile(acProfile->itemData(acProfile->currentIndex()).toString());
+    PowerDevilSettings::setLowProfile(lowProfile->itemData(lowProfile->currentIndex()).toString());
+    PowerDevilSettings::setWarningProfile(warningProfile->itemData(warningProfile->currentIndex()).toString());
+    PowerDevilSettings::setBatteryProfile(batteryProfile->itemData(batteryProfile->currentIndex()).toString());
 
     PowerDevilSettings::self()->writeConfig();
 }
@@ -172,6 +178,24 @@
 {
     KSharedConfigPtr profilesConfig = KSharedConfig::openConfig("powerdevil2profilesrc", KConfig::SimpleConfig);
 
+    // Request profiles to the daemon
+    QDBusMessage call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
+                                                       "org.kde.Solid.PowerManagement", "availableProfiles");
+    QDBusPendingReply< StringStringMap > reply = QDBusConnection::sessionBus().asyncCall(call);
+    reply.waitForFinished();
+
+    if (!reply.isValid()) {
+        kDebug() << "Error contacting the daemon!";
+        return;
+    }
+
+    StringStringMap profiles = reply.value();
+
+    if (profiles.isEmpty()) {
+        kDebug() << "No available profiles!";
+        return;
+    }
+
     acProfile->clear();
     batteryProfile->clear();
     lowProfile->clear();
@@ -182,20 +206,19 @@
         return;
     }
 
-    foreach(const QString &ent, profilesConfig->groupList()) {
-        KConfigGroup *group = new KConfigGroup(profilesConfig, ent);
+    for (StringStringMap::const_iterator i = profiles.constBegin(); i != profiles.constEnd(); ++i) {
+        KConfigGroup group(profilesConfig, i.key());
 
-        acProfile->addItem(KIcon(group->readEntry("icon")), ent);
-        batteryProfile->addItem(KIcon(group->readEntry("icon")), ent);
-        lowProfile->addItem(KIcon(group->readEntry("icon")), ent);
-        warningProfile->addItem(KIcon(group->readEntry("icon")), ent);
-        delete group;
+        acProfile->addItem(KIcon(group.readEntry("icon")), i.value(), i.key());
+        batteryProfile->addItem(KIcon(group.readEntry("icon")), i.value(), i.key());
+        lowProfile->addItem(KIcon(group.readEntry("icon")), i.value(), i.key());
+        warningProfile->addItem(KIcon(group.readEntry("icon")), i.value(), i.key());
     }
 
-    acProfile->setCurrentIndex(acProfile->findText(PowerDevilSettings::aCProfile()));
-    lowProfile->setCurrentIndex(acProfile->findText(PowerDevilSettings::lowProfile()));
-    warningProfile->setCurrentIndex(acProfile->findText(PowerDevilSettings::warningProfile()));
-    batteryProfile->setCurrentIndex(acProfile->findText(PowerDevilSettings::batteryProfile()));
+    acProfile->setCurrentIndex(acProfile->findData(PowerDevilSettings::aCProfile()));
+    lowProfile->setCurrentIndex(acProfile->findData(PowerDevilSettings::lowProfile()));
+    warningProfile->setCurrentIndex(acProfile->findData(PowerDevilSettings::warningProfile()));
+    batteryProfile->setCurrentIndex(acProfile->findData(PowerDevilSettings::batteryProfile()));
 
 }
 
diff -Naur kdebase-workspace-4.5.85/powerdevil//kcmodule/global/powerdevilglobalconfig.desktop ../powerdevil/kcmodule/global/powerdevilglobalconfig.desktop
--- kdebase-workspace-4.5.85/powerdevil//kcmodule/global/powerdevilglobalconfig.desktop	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/kcmodule/global/powerdevilglobalconfig.desktop	2010-12-17 12:00:44.940005101 -0800
@@ -21,6 +21,7 @@
 Name[hr]=Globalne postavke
 Name[hu]=Globális beállítások
 Name[ia]=Preferentias Global
+Name[it]=Impostazioni globali
 Name[kk]=:Жалпы жүйелік параметрлері
 Name[km]=ការ​កំណត់​សកល
 Name[ko]=전역 설정
@@ -45,7 +46,9 @@
 Comment[en_GB]=Configure global Power Management settings
 Comment[es]=Configuración de las preferencias globales de la gestión de energía
 Comment[et]=Toitehalduse globaalsed seadistused
+Comment[hu]=Globális energiakezelési beállítások
 Comment[ia]=Configurar preferentias global de gestion de Energia
+Comment[it]=Configura le impostazioni globali della gestione energetica
 Comment[kk]=:Жалпы жүйелік қуаттандыру параметрлерін баптау
 Comment[km]=កំណត់​រចនាសម្ព័ន្ធ​​ការ​កំណត់​​​ក្នុង​ការ​​គ្រប់គ្រង​​ថាមពល​សកល
 Comment[ko]=전역 전원 관리 설정
diff -Naur kdebase-workspace-4.5.85/powerdevil//kcmodule/profiles/EditPage.cpp ../powerdevil/kcmodule/profiles/EditPage.cpp
--- kdebase-workspace-4.5.85/powerdevil//kcmodule/profiles/EditPage.cpp	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/kcmodule/profiles/EditPage.cpp	2010-12-17 12:00:44.960005101 -0800
@@ -33,6 +33,7 @@
 #include <QtDBus/QDBusMessage>
 #include <QtDBus/QDBusReply>
 #include <QtDBus/QDBusConnection>
+#include <QtDBus/QDBusMetaType>
 
 #include <KConfigGroup>
 #include <KLineEdit>
@@ -53,11 +54,16 @@
                 )
 K_EXPORT_PLUGIN(PowerDevilProfilesKCMFactory("powerdevilprofilesconfig","powerdevil"))
 
+typedef QMap< QString, QString > StringStringMap;
+Q_DECLARE_METATYPE(StringStringMap)
+
 EditPage::EditPage(QWidget *parent, const QVariantList &args)
         : KCModule(PowerDevilProfilesKCMFactory::componentData(), parent, args)
         , m_profileEdited(false)
 {
-    setButtons(Apply | Help);
+    qDBusRegisterMetaType< StringStringMap >();
+
+    setButtons(Apply | Help | Default);
 
     KAboutData *about =
         new KAboutData("powerdevilprofilesconfig", "powerdevilprofilesconfig", ki18n("Power Profiles Configuration"),
@@ -85,24 +91,32 @@
     listLayout->addWidget(m_toolBar);
 
     m_toolBar->addAction(actionNewProfile);
+    m_toolBar->addAction(actionEditProfile);
     m_toolBar->addAction(actionDeleteProfile);
     m_toolBar->addSeparator();
     m_toolBar->addAction(actionImportProfiles);
     m_toolBar->addAction(actionExportProfiles);
+    m_toolBar->addAction(actionRestoreDefaultProfiles);
     m_toolBar->setToolButtonStyle(Qt::ToolButtonIconOnly);
 
     actionNewProfile->setIcon(KIcon("document-new"));
+    actionEditProfile->setIcon(KIcon("document-edit"));
     actionDeleteProfile->setIcon(KIcon("edit-delete-page"));
     actionImportProfiles->setIcon(KIcon("document-import"));
     actionExportProfiles->setIcon(KIcon("document-export"));
+    actionRestoreDefaultProfiles->setIcon(KIcon("document-revert"));
 
     connect(profilesList, SIGNAL(currentItemChanged(QListWidgetItem*, QListWidgetItem*)),
             SLOT(switchProfile(QListWidgetItem*, QListWidgetItem*)));
+    connect(this, SIGNAL(changed(bool)),
+            this, SLOT(onChanged(bool)));
 
     connect(actionDeleteProfile, SIGNAL(triggered()), SLOT(deleteCurrentProfile()));
+    connect(actionEditProfile, SIGNAL(triggered(bool)), SLOT(editProfile()));
     connect(actionNewProfile, SIGNAL(triggered()), SLOT(createProfile()));
     connect(actionImportProfiles, SIGNAL(triggered()), SLOT(importProfiles()));
     connect(actionExportProfiles, SIGNAL(triggered()), SLOT(exportProfiles()));
+    connect(actionRestoreDefaultProfiles, SIGNAL(triggered(bool)), SLOT(restoreDefaultProfiles()));
 
     reloadAvailableProfiles();
     ActionConfigWidget *actionConfigWidget = new ActionConfigWidget(0);
@@ -162,6 +176,11 @@
 {
 }
 
+void EditPage::onChanged(bool changed)
+{
+    m_profileEdited = changed;
+}
+
 void EditPage::load()
 {
     loadProfile();
@@ -169,31 +188,43 @@
 
 void EditPage::save()
 {
-    QString profile = profilesList->currentItem()->text();
-    saveProfile();
+    QString profile = profilesList->currentItem()->data(Qt::UserRole).toString();
+    saveProfile(profile);
     // Notify the daemon
-    QDBusMessage call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
-                                                       "org.kde.Solid.PowerManagement", "currentProfile");
-    QDBusPendingReply< QString > reply = QDBusConnection::sessionBus().asyncCall(call);
-    reply.waitForFinished();
+    notifyDaemon(profile);
+}
 
-    if (reply.isValid()) {
-        if (reply.value() == profile) {
-            // Ask to reload the profile
-            kDebug() << "Active profile edited, reloading profile";
-            call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
-                                                  "org.kde.Solid.PowerManagement", "reloadCurrentProfile");
+void EditPage::notifyDaemon(const QString &editedProfile)
+{
+    QDBusMessage call;
+    if (!editedProfile.isNull()) {
+        call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
+                                              "org.kde.Solid.PowerManagement", "currentProfile");
+        QDBusPendingReply< QString > reply = QDBusConnection::sessionBus().asyncCall(call);
+        reply.waitForFinished();
+
+        if (reply.isValid()) {
+            if (reply.value() == editedProfile) {
+                // Ask to reload the profile
+                kDebug() << "Active profile edited, reloading profile";
+                call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
+                                                      "org.kde.Solid.PowerManagement", "reloadCurrentProfile");
+            } else {
+                // Ask to reparse config
+                kDebug() << "Inactive profile edited, reparsing configuration";
+                call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
+                                                      "org.kde.Solid.PowerManagement", "reparseConfiguration");
+            }
         } else {
-            // Ask to reparse config
-            kDebug() << "Inactive profile edited, reparsing configuration";
+            kWarning() << "Invalid reply from daemon when asking for current profile!";
+            // To be sure, reload profile
             call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
-                                                  "org.kde.Solid.PowerManagement", "reparseConfiguration");
+                                                  "org.kde.Solid.PowerManagement", "reloadCurrentProfile");
         }
     } else {
-        kWarning() << "Invalid reply from daemon when asking for current profile!";
-        // To be sure, reload profile
+        // Refresh status
         call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
-                                              "org.kde.Solid.PowerManagement", "reloadCurrentProfile");
+                                              "org.kde.Solid.PowerManagement", "refreshStatus");
     }
 
     // Perform call
@@ -204,12 +235,23 @@
 {
     kDebug() << "Loading a profile";
 
-    if (!profilesList->currentItem())
+    if (!profilesList->currentItem()) {
         return;
+    }
 
-    kDebug() << profilesList->currentItem()->text();
+    // Check if the profile is not reserved
+    QString profileId = profilesList->currentItem()->data(Qt::UserRole).toString();
+    if (profileId == "Performance" || profileId == "Powersave" || profileId == "Aggressive powersave") {
+        actionDeleteProfile->setEnabled(false);
+        actionEditProfile->setEnabled(false);
+    } else {
+        actionDeleteProfile->setEnabled(true);
+        actionEditProfile->setEnabled(true);
+    }
 
-    KConfigGroup group(m_profilesConfig, profilesList->currentItem()->text());
+    kDebug() << profileId;
+
+    KConfigGroup group(m_profilesConfig, profileId);
 
     if (!group.isValid()) {
         return;
@@ -238,7 +280,7 @@
     QString profile;
 
     if (p.isEmpty()) {
-        profile = profilesList->currentItem()->text();
+        profile = profilesList->currentItem()->data(Qt::UserRole).toString();
     } else {
         profile = p;
     }
@@ -270,18 +312,31 @@
 {
     profilesList->clear();
 
-    m_profilesConfig->reparseConfiguration();
+    // Request profiles to the daemon
+    QDBusMessage call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
+                                                       "org.kde.Solid.PowerManagement", "availableProfiles");
+    QDBusPendingReply< StringStringMap > reply = QDBusConnection::sessionBus().asyncCall(call);
+    reply.waitForFinished();
 
-    if (m_profilesConfig->groupList().isEmpty()) {
+    if (!reply.isValid()) {
+        kDebug() << "Error contacting the daemon!";
+        return;
+    }
+
+    StringStringMap profiles = reply.value();
+
+    if (profiles.isEmpty()) {
         kDebug() << "No available profiles!";
         return;
     }
 
-    foreach (const QString &ent, m_profilesConfig->groupList()) {
-        KConfigGroup *group = new KConfigGroup(m_profilesConfig, ent);
-        QListWidgetItem *itm = new QListWidgetItem(KIcon(group->readEntry("icon")), ent);
+    m_profilesConfig->reparseConfiguration();
+
+    for (StringStringMap::const_iterator i = profiles.constBegin(); i != profiles.constEnd(); ++i) {
+        KConfigGroup group(m_profilesConfig, i.key());
+        QListWidgetItem *itm = new QListWidgetItem(KIcon(group.readEntry("icon")), i.value());
+        itm->setData(Qt::UserRole, i.key());
         profilesList->addItem(itm);
-        delete group;
     }
 
     profilesList->setCurrentRow(0);
@@ -289,22 +344,22 @@
 
 void EditPage::deleteCurrentProfile()
 {
-    if (!profilesList->currentItem() || profilesList->currentItem()->text().isEmpty()) {
+    if (!profilesList->currentItem()) {
         return;
     }
 
     // We're deleting it, we don't care anymore
-    m_profileEdited = false;
+    emit changed(false);
 
-    m_profilesConfig->deleteGroup(profilesList->currentItem()->text());
+    m_profilesConfig->deleteGroup(profilesList->currentItem()->data(Qt::UserRole).toString());
     m_profilesConfig->sync();
 
-    reloadAvailableProfiles();
-
     // Notify the daemon
     QDBusMessage call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
                                                        "org.kde.Solid.PowerManagement", "reparseConfiguration");
     QDBusConnection::sessionBus().asyncCall(call);
+
+    reloadAvailableProfiles();
 }
 
 void EditPage::createProfile(const QString &name, const QString &icon)
@@ -314,15 +369,16 @@
     }
     KConfigGroup group(m_profilesConfig, name);
     group.writeEntry("icon", icon);
+    group.writeEntry("name", name);
 
     group.sync();
 
-    reloadAvailableProfiles();
-
     // Notify the daemon
     QDBusMessage call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
                                                        "org.kde.Solid.PowerManagement", "reparseConfiguration");
     QDBusConnection::sessionBus().asyncCall(call);
+
+    reloadAvailableProfiles();
 }
 
 void EditPage::createProfile()
@@ -358,26 +414,30 @@
     delete dialog;
 }
 
-void EditPage::editProfile(const QString &prevname, const QString &icon)
+void EditPage::editProfile(const QString &id, const QString &name, const QString &icon)
 {
-    if (prevname.isEmpty())
+    if (id.isEmpty() || !m_profilesConfig->hasGroup(id)) {
         return;
+    }
 
-    KConfigGroup group(m_profilesConfig, prevname);
+    KConfigGroup group(m_profilesConfig, id);
 
     group.writeEntry("icon", icon);
+    group.writeEntry("name", name);
 
     group.sync();
 
-    reloadAvailableProfiles();
-
+    // Notify the daemon
+    notifyDaemon(id);
 
+    reloadAvailableProfiles();
 }
 
 void EditPage::editProfile()
 {
-    if (!profilesList->currentItem())
+    if (!profilesList->currentItem()) {
         return;
+    }
 
     KDialog *dialog = new KDialog(this);
     QWidget *wg = new QWidget();
@@ -395,13 +455,11 @@
 
     ed->setToolTip(i18n("The name for the new profile"));
     ed->setWhatsThis(i18n("Enter here the name for the profile you are creating"));
-    ed->setEnabled(false);
 
-    ed->setText(profilesList->currentItem()->text());
+    KConfigGroup group(m_profilesConfig, profilesList->currentItem()->data(Qt::UserRole).toString());
 
-    KConfigGroup *group = new KConfigGroup(m_profilesConfig, profilesList->currentItem()->text());
-
-    ibt->setIcon(group->readEntry("icon"));
+    ibt->setIcon(group.readEntry("icon"));
+    ed->setText(group.readEntry("name"));
 
     lay->addRow(lb);
     lay->addRow(ibt, ed);
@@ -412,11 +470,10 @@
     ed->setFocus();
 
     if (dialog->exec() == KDialog::Accepted) {
-        editProfile(profilesList->currentItem()->text(), ibt->icon());
+        editProfile(profilesList->currentItem()->data(Qt::UserRole).toString(), ed->text(), ibt->icon());
     }
 
     delete dialog;
-    delete group;
 }
 
 void EditPage::importProfiles()
@@ -439,6 +496,11 @@
 
     m_profilesConfig->sync();
 
+    // Notify the daemon
+    QDBusMessage call = QDBusMessage::createMethodCall("org.kde.Solid.PowerManagement", "/org/kde/Solid/PowerManagement",
+                                                       "org.kde.Solid.PowerManagement", "reparseConfiguration");
+    QDBusConnection::sessionBus().asyncCall(call);
+
     reloadAvailableProfiles();
 }
 
@@ -460,6 +522,24 @@
     delete toExport;
 }
 
+void EditPage::restoreDefaultProfiles()
+{
+    // Confirm
+    int ret = KMessageBox::warningContinueCancel(this, i18n("The KDE Power Management System will now generate a set of default "
+                                                            "profiles based on your computer's capabilities. This will also erase "
+                                                            "all existing profiles. "
+                                                            "Are you sure you want to continue?"), i18n("Restore Default Profiles"));
+    if (ret == KMessageBox::Continue) {
+        kDebug() << "Restoring defaults.";
+        PowerDevil::ProfileGenerator::generateProfiles();
+
+        // Notify the daemon
+        notifyDaemon();
+
+        reloadAvailableProfiles();
+    }
+}
+
 void EditPage::switchProfile(QListWidgetItem *current, QListWidgetItem *previous)
 {
     Q_UNUSED(current)
@@ -481,7 +561,7 @@
                      "Do you want to save it?"), i18n("Save Profile"));
 
         if (result == KMessageBox::Yes) {
-            saveProfile(previous->text());
+            saveProfile(previous->data(Qt::UserRole).toString());
             loadProfile();
         } else if (result == KMessageBox::No) {
             loadProfile();
@@ -502,7 +582,7 @@
 
 void EditPage::defaults()
 {
-    KCModule::defaults();
+    restoreDefaultProfiles();
 }
 
 #include "EditPage.moc"
diff -Naur kdebase-workspace-4.5.85/powerdevil//kcmodule/profiles/EditPage.h ../powerdevil/kcmodule/profiles/EditPage.h
--- kdebase-workspace-4.5.85/powerdevil//kcmodule/profiles/EditPage.h	2010-11-11 06:40:47.000000000 -0800
+++ ../powerdevil/kcmodule/profiles/EditPage.h	2010-12-17 12:00:44.960005101 -0800
@@ -44,18 +44,22 @@
     virtual void defaults();
 
 private slots:
+    void onChanged(bool changed);
     void loadProfile();
     void saveProfile(const QString &p = QString());
     void switchProfile(QListWidgetItem *current, QListWidgetItem *previous);
     void reloadAvailableProfiles();
     void createProfile(const QString &name, const QString &icon);
-    void editProfile(const QString &prevname, const QString &icon);
+    void editProfile(const QString &id, const QString &name, const QString &icon);
     void deleteCurrentProfile();
     void createProfile();
     void editProfile();
 
     void importProfiles();
     void exportProfiles();
+    void restoreDefaultProfiles();
+
+    void notifyDaemon(const QString &editedProfile = QString());
 
     void openUrl(const QString &url);
 
diff -Naur kdebase-workspace-4.5.85/powerdevil//kcmodule/profiles/powerdevilprofilesconfig.desktop ../powerdevil/kcmodule/profiles/powerdevilprofilesconfig.desktop
--- kdebase-workspace-4.5.85/powerdevil//kcmodule/profiles/powerdevilprofilesconfig.desktop	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/kcmodule/profiles/powerdevilprofilesconfig.desktop	2010-12-17 12:00:44.960005101 -0800
@@ -19,7 +19,9 @@
 Name[es]=Perfiles de energía
 Name[et]=Voolutarbe profiilid
 Name[hr]=Energetski profili
+Name[hu]=Energiakezelési profilok
 Name[ia]=Profilos de energia
+Name[it]=Profili energetici
 Name[ja]=電源プロファイル
 Name[kk]=Қуаттандыру профильдері
 Name[km]=ទម្រង់​ថាមពល
@@ -46,7 +48,9 @@
 Comment[es]=Configurar los perfiles de gestión de energía
 Comment[et]=Voolutarbe profiilide teenuste seadistamine
 Comment[hr]=Podešavanje profila za upravljanje potrošnjom energije
+Comment[hu]=Energiakezelési profilok beállítása
 Comment[ia]=Configurar profilos de gestion de Energia
+Comment[it]=Configura i profili di gestione energetica
 Comment[ja]=電源管理プロファイルを設定します
 Comment[kk]=Қуаттандыру профильдерін баптау
 Comment[km]=កំណត់​រចនាសម្ព័ន្ធ​ទម្រង់​គ្រប់គ្រង​ថាមពល
diff -Naur kdebase-workspace-4.5.85/powerdevil//kcmodule/profiles/profileEditPage.ui ../powerdevil/kcmodule/profiles/profileEditPage.ui
--- kdebase-workspace-4.5.85/powerdevil//kcmodule/profiles/profileEditPage.ui	2010-10-27 12:54:59.000000000 -0700
+++ ../powerdevil/kcmodule/profiles/profileEditPage.ui	2010-12-17 12:00:44.956671768 -0800
@@ -76,6 +76,16 @@
     <string>Export Profiles</string>
    </property>
   </action>
+  <action name="actionRestoreDefaultProfiles">
+   <property name="text">
+    <string>Restore Default Profiles</string>
+   </property>
+  </action>
+  <action name="actionEditProfile">
+   <property name="text">
+    <string>Edit Profile</string>
+   </property>
+  </action>
  </widget>
  <customwidgets>
   <customwidget>
diff -Naur kdebase-workspace-4.5.85/powerdevil//powerdevil.notifyrc ../powerdevil/powerdevil.notifyrc
--- kdebase-workspace-4.5.85/powerdevil//powerdevil.notifyrc	2010-12-01 14:22:40.000000000 -0800
+++ ../powerdevil/powerdevil.notifyrc	2010-12-17 12:00:44.970005101 -0800
@@ -2,9 +2,12 @@
 Name=KDE Power Management System
 Name[ca]=Sistema de gestió d'energia del KDE
 Name[da]=KDE's strømstyringssystem
+Name[en_GB]=KDE Power Management System
+Name[es]=Sistema de gestión de energía de KDE
 Name[et]=KDE toitehalduse süsteem
 Name[hu]=KDE energiakezelő rendszer
 Name[ia]=Systema de Gestion de Energia de KDE
+Name[it]=Sistema di gestione energetica di KDE
 Name[kk]=KDE қуаттандыруды басқару жүйесі
 Name[km]=ប្រព័ន្ធ​គ្រប់គ្រង​ថាមពល​របស់ KDE
 Name[lt]=KDE energijos valdymo sistema
@@ -22,8 +25,11 @@
 Comment=Notifications for KDE Power Management system
 Comment[ca]=Notificacions per al sistema de gestió d'energia del KDE
 Comment[da]=Bekendtgørelser for KDE's strømstyringssystem
+Comment[en_GB]=Notifications for KDE Power Management system
+Comment[es]=Notificaciones del sistema de gestión de energía de KDE
 Comment[et]=KDE toitehalduse süsteemi märguanded
 Comment[ia]=Notificationes pro systema de gestion de Energia de KDE
+Comment[it]=Notifiche del sistema di gestione energetica di KDE
 Comment[kk]=KDE қуаттандыру басқару жүйесінің құлқтандырулары
 Comment[km]=ការ​ជូន​ដំណឹង​សម្រាប់​​ប្រព័ន្ធ​គ្រប់គ្រង​ថាមពល KDE
 Comment[lt]=KDE energijos valdymo sistemos pranešimai
@@ -128,7 +134,7 @@
 Comment[ar]=يُستخدم للتنبيهات التحذيرية
 Comment[ast]=Usáu pa notificaciones d'avisu
 Comment[be@latin]=Dla aścierahalnych paviedamleńniaŭ
-Comment[bg]=Предупреждения
+Comment[bg]=Използва се за предупреждения
 Comment[ca]=S'usa per a les notificacions d'avís
 Comment[ca@valencia]=S'usa per a les notificacions d'avís
 Comment[cs]=Použito pro varování a upozornění
@@ -1579,7 +1585,7 @@
 Name[is]=Framkvæmi verk í biðstöðu
 Name[it]=Svolgimento della procedura di sospensione
 Name[ja]=サスペンドの実行
-Name[kk]=Қалғуға ауысу
+Name[kk]=Аялдау режіміне ауысу
 Name[km]=អនុវត្ត​ការងារ suspension
 Name[kn]=ತಡೆಹಿಡಿಯು ಕಾರ್ಯವನ್ನು ನಿರ್ವಹಿಸಲಾಗುತ್ತಿದೆ
 Name[ko]=대기 모드로 들어가는 중
@@ -1644,7 +1650,7 @@
 Comment[is]=Þessi tilkynning er birt þegar verki er lokið á meðan tölvan var í biðstöðu, sem síðan ræsir niðurtalningu. Þar með er mælt með því að leyfa verkinu að klárast.
 Comment[it]=Questa notifica è mostrata quando sta per essere svolta la procedura di sospensione e avvia un conto alla rovescia. Si consiglia quindi di lasciarla attiva.
 Comment[ja]=この通知は自動的にスタンバイモードに入ったりサスペンド/ハイバネートする前に表示されます。この通知によって、それぞれのアクションのカウントダウンが開始されるので、有効にしておくことを強くお勧めします。
-Comment[kk]=Бұл құлақтандыру қалғу режіміне ауысуға қалған уакыт санауы басталғанда көрсетіледі. Бұған кедергі қылмауы абзал.
+Comment[kk]=Бұл құлақтандыру аялдау режіміне ауысуға қалған уакыт санауы басталғанда көрсетіледі. Бұған кедергі қылмауы абзал.
 Comment[km]=កា​រជូន​ដំណឹង​នេះ​ត្រូវ​បានបង្ហាញ​នៅពេល​ការងារ suspension រៀប​នឹង​ធ្វើ និង​វាកេះ​ឲ្យ​រាប់​ថយក្រោយ ។ ដូច្នេះ​វា​ត្រូវបានណែនាំ​ឲ្យ​ទុកវាសិន ។
 Comment[ko]=대기 모드로 곧 들어갑니다. 잠깐 동안의 시간 여유가 주어지며, 그 동안 작업을 정리하십시오.
 Comment[lt]=Šis pranešimas rodomas kai ruošiamasi sustabdyti kompiuterį, kai įsijungia sekundžių iki išjungimo skaičiavimas. Todėl primygtinai siūlytina palikti šią parinktį įjungtą.
@@ -1686,9 +1692,13 @@
 Name=Internal KDE Power Management System Error
 Name[ca]=Error intern del sistema de gestió d'energia del KDE
 Name[da]=Intern fejl i KDE's strømstyringssystem
+Name[en_GB]=Internal KDE Power Management System Error
+Name[es]=Error interno del sistema de gestión de energía de KDE
 Name[et]=Sisemine KDE toitehalduse süsteemi tõrge
+Name[hu]=Belső hiba a KDE energiakezelő rendszerében
 Name[ia]=Error Interne Systema de Gestion de Energia de KDE
-Name[kk]=KDE қуаттандыру басқару жүйесінің ішкі қатесі
+Name[it]=Errore interno del sistema di gestione energetica di KDE
+Name[kk]=KDE қуаттандыруды басқару жүйесінің ішкі қатесі
 Name[km]=កំហុស​របស់​ប្រព័ន្ធ​គ្រប់គ្រង​ថាមពល​ KDE ខាង​ក្នុង
 Name[lt]=Vidinė KDE energijos valdymo sistemos klaida
 Name[nb]=Intern feil i KDE strømstyringssystem
@@ -1704,8 +1714,12 @@
 Comment=The KDE Power Management System has triggered an internal error
 Comment[ca]=El sistema de gestió d'energia del KDE ha activat un error intern
 Comment[da]=KDE's strømstyringssystem har udløst en intern fejl
+Comment[en_GB]=The KDE Power Management System has triggered an internal error
+Comment[es]=El sistema de gestión de energía de KDE ha sufrido un error interno
 Comment[et]=KDE toitehalduse süsteemi tabas sisemine tõrge
+Comment[hu]=A KDE Energiakezelő rendszere belső hibát okozott
 Comment[ia]=Le Systema de Gestion de Energia de KDE ha generate un error interne
+Comment[it]=Il sistema di gestione energetica di KDE ha causato un errore interno
 Comment[kk]=KDE қуаттандыру басқару жүйесінде ішкі бір қатесі орын алды
 Comment[km]=ប្រព័ន្ធ​គ្រប់គ្រង​ថាមពល KDE មាន​កំហុស​ខាង​ក្នុង
 Comment[lt]=KDE energijos valdymo sistema sužadino vidinę klaidą
@@ -1756,7 +1770,7 @@
 Name[is]=Biðstaða hindruð
 Name[it]=Sospensione inibita
 Name[ja]=サスペンドが阻止されました
-Name[kk]=Қалғуға ауысу кідірілді
+Name[kk]=Аялдауы кідірілді
 Name[km]=បានហាមឃាត់​ការ​ផ្អាក
 Name[kn]=ತಡೆಹಿಡಿಯುವಿಕೆಯನ್ನು ನಿರ್ಬಂಧಿಸಲಾಗಿದೆ
 Name[ko]=대기 모드로 들어가지 않았음
@@ -1821,7 +1835,7 @@
 Comment[is]=Biðstaðan var hindruð að kröfu forrits
 Comment[it]=La sospensione è stata inibita perché un'applicazione l'ha richiesto
 Comment[ja]=アプリケーションの要求によりサスペンドが阻止されました
-Comment[kk]=Қалғу режіміне өту бір бағдарламаның талабымен кідірілді
+Comment[kk]=Аялдау режіміне өту бір бағдарламаның талабымен кідірілді
 Comment[km]=ការ​ផ្អាក​ត្រូវ​បានហាមឃាត់​ ពីព្រោះ​កម្មវិធី​បាន​ស្នើ​វា
 Comment[kn]=ತಡೆಹಿಡಿಯುವಿಕೆಯನ್ನು ನಿರ್ಬಂಧಿಸಲಾಗಿದೆ ಏಕೆಂದರೆ ಅನ್ವಯವು ಹಾಗೆ ಮಾಡಲು ಮನವಿ ಸಲ್ಲಿಸಿತ್ತು
 Comment[ko]=프로그램의 요청으로 대기 모드에 들어가지 않았습니다
@@ -1862,12 +1876,16 @@
 Name=Broken battery notification
 Name[ca]=Notificació de bateria trencada
 Name[da]=Bekendtgørelse af defekt batteri
+Name[en_GB]=Broken battery notification
+Name[es]=Notificación de batería estropeada
 Name[et]=Katkise aku märguanne
 Name[ia]=Notification de Batteria rupte
+Name[it]=Notifica di batterie difettose
 Name[kk]=Батареяның істен шыққаны туралы хабарлауы
 Name[km]=ការ​ជូន​ដំណឹង​ថ្ម​ខូច
 Name[lt]=Pranešimas apie sugedusią bateriją
 Name[nb]=Varsling om ødelagt batteri
+Name[nds]=Bescheed över Batteriefehlers
 Name[nl]=Gebroken batterijmelding
 Name[pa]=ਖਰਾਬ ਨੈਟਰੀ ਨੋਟੀਫਿਕੇਸ਼ਨ
 Name[pt]=Notificação de baterias com problemas
@@ -1879,14 +1897,18 @@
 Comment=This notification will pop up if KDE Power Management System detects some troubles with one of your batteries
 Comment[ca]=Aquesta notificació apareixerà si el sistema de gestió d'energia del KDE detecta algun problema amb alguna de les bateries
 Comment[da]=Denne bekendtgørelse vil dukke op hvis KDE's strømstyringssystem finder problemer med et af dine batterier
+Comment[en_GB]=This notification will pop up if KDE Power Management System detects some troubles with one of your batteries
+Comment[es]=Esta notificación se activará si el sistema de gestión de energía de KDE detecta un problema en alguna de sus baterías
 Comment[et]=Seda märguannet näeb, kui KDE toitehalduse süsteem tuvastab mingeid probleeme mõne su akuga
 Comment[ia]=Iste notification apparera con un popup si le Systema de Gestion de Energia de KDE releva alcun problemas con un de tu batterias
+Comment[it]=La notifica apparirà se il sistema di gestione energetica di KDE rileverà dei problemi con una batteria
 Comment[kk]=Бұл KDE қуаттандыруды басқару жүйесі батареяыздың  бір мәселесін байқағанда шығаратын құлақтандыру
 Comment[km]=ការ​ជូនដំណឹង​នេះ​នឹង​លេចឡើង​ ប្រសិនបើ​ប្រព័ន្ធ​គ្រប់គ្រង​​ថាមពល​របស់ KDE រក​ឃើញ​បញ្ហា​ខ្លះ​ជា​មួយ​នឹង​ថ្ម​របស់​អ្នក​
 Comment[lt]=Šis pranešimas bus rodomas tada, kai KDE energijos valdymo sistema aptiks kokių nors problemų su viena iš jūsų baterijų
 Comment[nb]=Denne varslingen spretter opp hvis KDE Strømstyringssystem oppdager vanskeligheter med et av batteriene dine
 Comment[nds]=Disse Opduker warrt wiest, wenn de KDE-Stroomkuntrullsysteem Problemen mit een vun Dien Batterien opdeckt hett.
 Comment[nl]=Deze melding verschijnt als het KDE energiebeheersysteem een probleemdetecteert met één van uw batterijen
+Comment[pa]=ਇਹ ਨੋਟੀਫਿਕੇਸ਼ਨ ਆਵੇਗਾ, ਜੇ KDE ਪਾਵਰ ਮੈਨਜੇਮੈਂਟ ਸਿਸਟਮ ਤੁਹਾਡੀਆਂ ਬੈਟਰੀਆਂ 'ਚ ਕੋਈ ਸਮੱਸਿਆ ਲੱਭੇਗਾ।ਇਹ ਨੋਟੀਫਿਕੇਸ਼ਨ ਆਵੇਗਾ, ਜੇ KDE ਪਾਵਰ ਮੈਨਜੇਮੈਂਟ ਸਿਸਟਮ ਤੁਹਾਡੀਆਂ ਬੈਟਰੀਆਂ 'ਚ ਕੋਈ ਸਮੱਸਿਆ ਲੱਭੇਇਹ ਨੋਟੀਫਿਕੇਸ਼ਨ ਆਵੇਗਾ, ਜੇ KDE ਪਾਵਰ ਮੈਨਜੇਮੈਂਟ ਸਿਸਟਮ ਤੁਹਾਡੀਆਂ ਬੈਟਰੀਆਂ 'ਚ ਕੋਈ ਸਮੱਸਿਆ ਲੱਭਗਇਹ ਨੋਟੀਫਿਕੇਸ਼ਨ ਆਵੇਗਾ, ਜੇ KDE ਪਾਵਰ ਮੈਨੇਇਹ ਨੋਟੀਫਿਕੇਸ਼ਨ ਇਹ ਨੋਟੀਫਿੇਸ
 Comment[pt]=Esta notificação irá aparecer se o Sistema de Gestão de Energia do KDE detectar algum problema com alguma das suas baterias
 Comment[pt_BR]=Esta notificação aparecerá se o Sistema de Gerenciamento de Energia do KDE detectar algum problema com uma das suas baterias
 Comment[sv]=Den här underrättelsen dyker upp om KDE:s strömsparhantering detekterar några problem med något av batterierna
